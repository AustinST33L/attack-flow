(function(e){function t(t){for(var s,o,a=t[0],l=t[1],c=t[2],d=0,h=[];d<a.length;d++)o=a[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&h.push(n[o][0]),n[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);u&&u(t);while(h.length)h.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],s=!0,o=1;o<i.length;o++){var a=i[o];0!==n[a]&&(s=!1)}s&&(r.splice(t--,1),e=l(l.s=i[0]))}return e}var s={},o={app:0},n={app:0},r=[];function a(e){return l.p+"js/"+({}[e]||e)+"."+{"chunk-3b8130fb":"25d3caed","chunk-46cf60ae":"84b264b5","chunk-4a96a04e":"698803e2"}[e]+".js"}function l(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.e=function(e){var t=[],i={"chunk-3b8130fb":1,"chunk-46cf60ae":1,"chunk-4a96a04e":1};o[e]?t.push(o[e]):0!==o[e]&&i[e]&&t.push(o[e]=new Promise((function(t,i){for(var s="css/"+({}[e]||e)+"."+{"chunk-3b8130fb":"e200d54a","chunk-46cf60ae":"2e5d066b","chunk-4a96a04e":"70eea7d0"}[e]+".css",n=l.p+s,r=document.getElementsByTagName("link"),a=0;a<r.length;a++){var c=r[a],d=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(d===s||d===n))return t()}var h=document.getElementsByTagName("style");for(a=0;a<h.length;a++){c=h[a],d=c.getAttribute("data-href");if(d===s||d===n)return t()}var u=document.createElement("link");u.rel="stylesheet",u.type="text/css",u.onload=t,u.onerror=function(t){var s=t&&t.target&&t.target.src||n,r=new Error("Loading CSS chunk "+e+" failed.\n("+s+")");r.code="CSS_CHUNK_LOAD_FAILED",r.request=s,delete o[e],u.parentNode.removeChild(u),i(r)},u.href=n;var p=document.getElementsByTagName("head")[0];p.appendChild(u)})).then((function(){o[e]=0})));var s=n[e];if(0!==s)if(s)t.push(s[2]);else{var r=new Promise((function(t,i){s=n[e]=[t,i]}));t.push(s[2]=r);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,l.nc&&d.setAttribute("nonce",l.nc),d.src=a(e);var h=new Error;c=function(t){d.onerror=d.onload=null,clearTimeout(u);var i=n[e];if(0!==i){if(i){var s=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;h.message="Loading chunk "+e+" failed.\n("+s+": "+o+")",h.name="ChunkLoadError",h.type=s,h.request=o,i[1](h)}n[e]=void 0}};var u=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return Promise.all(t)},l.m=e,l.c=s,l.d=function(e,t,i){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(l.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)l.d(i,s,function(t){return e[t]}.bind(null,s));return i},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var h=0;h<c.length;h++)t(c[h]);var u=d;r.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("cd49")},"0da8":function(e,t,i){},"12bf":function(e,t,i){"use strict";i("157b")},"13c3":function(e,t,i){"use strict";function s(e,t,i,s,o,n=12,r=0){let a=s-t,l=o-i,c=Math.atan2(l,a),d=s-n*Math.cos(c-Math.PI/6),h=o-n*Math.sin(c-Math.PI/6),u=s-n*Math.cos(c+Math.PI/6),p=o-n*Math.sin(c+Math.PI/6);e.beginPath(),e.moveTo(d,h),e.lineTo(u,p),e.lineTo(s,o),e.closePath()}function o(e,t,i,s,o,n,r=1){t+=r/2,i+=r/2,s-=r,o-=r,n="number"===typeof n?{tl:n,tr:n,br:n,bl:n}:Object.assign({tl:0,tr:0,br:0,bl:0},n),e.beginPath(),e.moveTo(t+n.tl,i),e.lineTo(t+s-n.tr,i),e.quadraticCurveTo(t+s,i,t+s,i+n.tr),e.lineTo(t+s,i+o-n.br),e.quadraticCurveTo(t+s,i+o,t+s-n.br,i+o),e.lineTo(t+n.bl,i+o),e.quadraticCurveTo(t,i+o,t,i+o-n.bl),e.lineTo(t,i+n.tl),e.quadraticCurveTo(t,i,t+n.tl,i),e.closePath()}i.d(t,"g",(function(){return s})),i.d(t,"h",(function(){return o})),i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c})),i.d(t,"e",(function(){return d})),i.d(t,"m",(function(){return h})),i.d(t,"i",(function(){return u})),i.d(t,"j",(function(){return p})),i.d(t,"k",(function(){return g})),i.d(t,"l",(function(){return f})),i.d(t,"f",(function(){return m})),i.d(t,"d",(function(){return _}));class n{constructor(){this._listeners=new Map}on(e,t){this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e).unshift(t)}once(e,t){let i=(...s)=>{let o=this._listeners.get(e);o.splice(o.indexOf(i),1),t(...s)};this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e).unshift(i)}emit(e,...t){if(this._listeners.has(e)){let i=this._listeners.get(e);for(let e=i.length-1;0<=e;e--)i[e](...t)}}removeAllListeners(e){void 0!==e?this._listeners.delete(e):this._listeners.clear()}}var r=i("9ab4");class a{constructor(){this._fontList=new Map([["default",new l({size:"10pt",family:"sans-serif"})]])}getFont(e){let t=a.getCssFontString(e);return this._fontList.has(t)?this._fontList.get(t):this._fontList.get("default")}loadFonts(e,t=4e3){return Object(r["a"])(this,void 0,void 0,(function*(){let i=[];for(let n of e)i.push(this.loadFont(n,t));let s=yield Promise.allSettled(i),o=[];for(let t=0;t<s.length;t++)"fulfilled"!==s[t].status&&o.push(a.getCssFontString(e[t]));if(o.length){let e=`'${o.join("', '")}'`;throw new Error("The following fonts failed to load: "+e)}}))}loadFont(e,t=4e3){return Object(r["a"])(this,void 0,void 0,(function*(){let i=a.getCssFontString(e),s=document.fonts;if(s.check(i))return this._fontList.has(i)||this._fontList.set(i,new l(e)),!0;{let o,n=this._fontList.set.bind(this._fontList),a=Date.now(),c=new Promise((o,c)=>Object(r["a"])(this,void 0,void 0,(function*(){(function d(){return Object(r["a"])(this,void 0,void 0,(function*(){t<=Date.now()-a?c(new Error(`Failed to load font '${i}' request timed out after ${t}ms.`)):s.load(i).then(t=>{if(0<t.length){let t=s.check(i);t&&n(i,new l(e)),o(t)}else setTimeout(d,50)},c)}))})()}))),d=new Promise((e,s)=>{o=setTimeout(()=>s(new Error(`Failed to load font '${i}' request timed out after ${t}ms.`)),t)}),h=yield Promise.race([c,d]);return clearTimeout(o),h}}))}static getCssFontString(e){var t;return`${null!==(t=e.weight)&&void 0!==t?t:400} ${e.size} ${e.family}`}}class l{constructor(e){this.css=a.getCssFontString(e),this.descriptor=e,this._ctx=document.createElement("canvas").getContext("2d"),this._ctx.font=this.css,this._widthIndex=new Map;for(let t of l.DEFAULT_INDEX)this._widthIndex.set(t,this.measureWidth(t))}measureWidth(e){if(document.fonts.check(this.css))return this._ctx.measureText(e).width;throw new Error(`The font '${this.css}' has not been loaded. The width of '${e}' cannot be measured.`)}measure(e){if(document.fonts.check(this.css)){let t=this._ctx.measureText(e);return{width:t.width,ascent:t.actualBoundingBoxAscent,descent:t.actualBoundingBoxDescent}}throw new Error(`The font '${this.css}' has not been loaded. The width of '${e}' cannot be measured.`)}getCharWidth(e){return this._widthIndex.has(e)||this._widthIndex.set(e,this.measureWidth(e)),this._widthIndex.get(e)}wordWrap(e,t){let i=e.trim().split(/\n/),s=[];for(let o=0;o<i.length;o++)i[o]?s[o]=this.lineWrap(i[o],t):s[o]=i[o];return s.flat()}lineWrap(e,t){let i="",s=0,o=[],n=e.split(l.WHITESPACE).filter(Boolean),r=l.WHITESPACE.test(n[0])?0:1;for(let a=0;a<n.length;a++){let e=this.measureWidth(n[a]);if(a%2!==r)if(t<s+e&&(0!==a&&(o.push(i.trimEnd()),i="",s=0),t<e)){let r=n[a];for(let n=0;n<r.length;n++)e=this.getCharWidth(r[n]),0!==n&&t<s+e&&(o.push(i),i="",s=0),i+=r[n],s+=e}else i+=n[a],s+=e;else i+=n[a],s+=e}return o.push(i.trimEnd()),o}}l.DEFAULT_INDEX="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\t ",l.WHITESPACE=/(\s+)/;const c=new a;function d(e,t,i){return Math.min(Math.max(e,t),i)}function h(e,t){return Math.sign(e)*Math.round(Math.abs(e)/t)*t}function u(e,t,i=5){let s=Math.pow(10,i);return Math.floor(e*s)===Math.floor(t*s)}function p(e){let t=0;for(let i in e)t|=e[i];return t}function g(e,t,i,s,o){let n=o/2,r=i-e,a=s-t,l=Math.acos(r/Math.sqrt(Math.pow(r,2)+Math.pow(a,2))),c=n*Math.sin(l),d=n*Math.cos(l);return[e-c,t-d,e+c,t+d,i+c,s+d,i-c,s-d]}function f(e,t,i){let s=1/0,o=1/0,n=-1/0,r=-1/0;for(let a=0;a<i.length;a+=2)s=Math.min(s,i[a]),o=Math.min(o,i[a+1]),n=Math.max(n,i[a]),r=Math.max(r,i[a+1]);if(s<e&&e<n&&o<t&&t<r){let s=e,o=t,r=n+1,a=t,l=0,c=i.length;for(let e=0;e<c;e+=2){let t=b(s,o,r,a,i[e],i[e+1],i[(e+2)%c],i[(e+3)%c]);t&&l++}return l%2!==0}return!1}function b(e,t,i,s,o,n,r,a){let l,c,d,h,u,p,g,f;return l=t-s,c=i-e,d=e*s-i*t,g=l*o+c*n+d,f=l*r+c*a+d,!(g<0&&f<0||g>0&&f>0)&&(h=n-a,u=r-o,p=o*a-r*n,g=h*e+u*t+p,f=h*i+u*s+p,!(g<0&&f<0||g>0&&f>0)&&l*u-h*c!=0)}function m(e){let t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}var _;(function(e){e[e["Left"]=0]="Left",e[e["Middle"]=1]="Middle",e[e["Right"]=2]="Right"})(_||(_={}))},"14d9":function(e){e.exports=JSON.parse('{"file":{"image_export":{"padding":30}},"edit":{"clone_offset":[2,2]},"view":{"diagram":{"display_grid":true,"display_shadows":true,"display_debug_mode":false,"render_high_quality":true,"disable_shadows_at":0.7}},"hotkeys":{"file":{"new_file":"Control+N","open_file":"Control+O","save_file":"Control+S","save_image":"","save_select_image":"","publish_file":"","open_library":"","save_library":""},"edit":{"undo":"Control+Z","redo":"Control+Y","cut":"Control+X","copy":"Control+C","paste":"Control+V","delete":"Backspace","duplicate":"Control+D","select_all":"Control+A"},"layout":{"selection_to_front":"Control+Shift+F","selection_to_back":"Control+Shift+B","bring_selection_forward":"","send_selection_backward":"","align_left":"","align_center":"","align_right":"","align_top":"","align_middle":"","align_bottom":"","group":"Control+G","ungroup":"Control+Shift+U","open_group":"","close_group":""},"view":{"toggle_grid":"Control+Shift+G","toggle_shadows":"","reset_view":"Escape","zoom_in":"","zoom_out":"","fullscreen":"","jump_to_selection":"Shift+Z","jump_to_parents":"Shift+P","jump_to_children":"Shift+C","toggle_debug_view":""},"select":{"many":"Control"}}}')},"157b":function(e,t,i){},"1a8c":function(e,t,i){"use strict";i("b17c")},"1aaf":function(e,t,i){"use strict";i("a5cb")},"1bb6":function(e,t,i){"use strict";i("738f")},"1ce9":function(e,t,i){},"1dd9":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"e",(function(){return a})),i.d(t,"f",(function(){return l})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return d})),i.d(t,"i",(function(){return h})),i.d(t,"j",(function(){return u})),i.d(t,"k",(function(){return p})),i.d(t,"l",(function(){return g})),i.d(t,"m",(function(){return f})),i.d(t,"n",(function(){return b})),i.d(t,"o",(function(){return m})),i.d(t,"p",(function(){return v})),i.d(t,"d",(function(){return y}));var s=i("13c3");const o={Free:0,Grid:1},n=Object(s["j"])(o),r={Default:0,Pointer:2,Crosshair:4,Move:6,NotAllowed:8,Grab:10,Grabbing:12,N_Resize:14,E_Resize:16,S_Resize:18,W_Resize:20,EW_Resize:22,NS_Resize:24,Col_Resize:26,Row_Resize:28},a=Object(s["j"])(r),l={Off:0,Direct:32,Indirect:64},c=Object(s["j"])(l),d={False:0,True:128},h=Object(s["j"])(d),u={False:0,True:256},p=Object(s["j"])(u),g={Normal:512,High:1024},f=Object(s["j"])(g),b={Unselected:0,Single:2048,Multi:4096},m=Object(s["j"])(b),_={None:0,Node:8192,Edge:16384,EdgeSource:24576,EdgeTarget:32768},v=Object(s["j"])(_),y={[r.Default]:"default",[r.Pointer]:"pointer",[r.Crosshair]:"crosshair",[r.Move]:"move",[r.NotAllowed]:"not-allowed",[r.Grab]:"grab",[r.Grabbing]:"grabbing",[r.N_Resize]:"n-resize",[r.E_Resize]:"e-resize",[r.S_Resize]:"s-resize",[r.W_Resize]:"w-resize",[r.EW_Resize]:"ew-resize",[r.NS_Resize]:"ns-resize",[r.Col_Resize]:"col-resize",[r.Row_Resize]:"row-resize"}},"24a6":function(e,t,i){"use strict";i.d(t,"a",(function(){return s["a"]})),i.d(t,"d",(function(){return s["c"]})),i.d(t,"g",(function(){return s["f"]})),i.d(t,"o",(function(){return s["n"]})),i.d(t,"e",(function(){return s["d"]})),i.d(t,"r",(function(){return o["e"]})),i.d(t,"s",(function(){return o["m"]})),i.d(t,"j",(function(){return o["d"]})),i.d(t,"n",(function(){return n["g"]})),i.d(t,"f",(function(){return r["f"]})),i.d(t,"m",(function(){return r["m"]})),i.d(t,"i",(function(){return r["l"]})),i.d(t,"q",(function(){return a["e"]})),i.d(t,"p",(function(){return l})),i.d(t,"k",(function(){return x})),i.d(t,"l",(function(){return B})),i.d(t,"h",(function(){return h})),i.d(t,"c",(function(){return D})),i.d(t,"b",(function(){return C}));var s=i("1dd9"),o=i("13c3"),n=i("5368"),r=i("cbc0"),a=i("317b");class l{static toGraph(e){let t,i=[],s=[];for(let o of e.getSubtree()){switch(o.getSemanticRole()){case a["e"].Node:t=s;break;case a["e"].Edge:t=i;break;default:continue}t.push({id:o.id,template:o.template,data:o.toExport(),prev:this.getPrevGraphLinks(o).map(e=>e.id),next:this.getNextGraphLinks(o).map(e=>e.id)})}return{edges:i,nodes:s}}static getNextGraphLinks(e){switch(e.getSemanticRole()){case a["e"].Edge:return this.getNodes(this.getEdgeTargetsFor(e));case a["e"].Node:return this.getEdges(this.getEdgeSourcesFor(e));default:return[]}}static getPrevGraphLinks(e){switch(e.getSemanticRole()){case a["e"].Edge:return this.getNodes(this.getEdgeSourcesFor(e));case a["e"].Node:return this.getEdges(this.getEdgeTargetsFor(e));default:return[]}}static getNodes(e){let t=[];for(let i of e){let e=this.getNode(i);e&&t.push(e)}return t}static getNode(e){if(!(e instanceof r["c"])||!e.hasRole(a["e"].EdgeSource)&&!e.hasRole(a["e"].EdgeTarget))return;let t=e.anchor;while(t){if(t.hasRole(a["e"].Node))return t;t=t.parent}}static getEdges(e){let t=[];for(let i of e){let e=this.getEdge(i);e&&t.push(e)}return t}static getEdge(e){if(!e.hasRole(a["e"].EdgeSource)&&!e.hasRole(a["e"].EdgeTarget))return;let t=e.parent;while(t){if(t.hasRole(a["e"].Edge))return t;t=t.parent}}static getEdgeSources(e){let t=[];for(let i of e)t=t.concat(this.getEdgeSourcesFor(i));return t}static getEdgeSourcesFor(e){if(!e.hasRole(a["e"].Edge)&&!e.hasRole(a["e"].Node))return[];let t=[e],i=[];while(t.length){let e=t.pop();if(e.hasRole(a["e"].EdgeSource))i.push(e);else for(let i of e.children)t.push(i)}return i}static getEdgeTargets(e){let t=[];for(let i of e)t=t.concat(this.getEdgeTargetsFor(i));return t}static getEdgeTargetsFor(e){if(!e.hasRole(a["e"].Edge)&&!e.hasRole(a["e"].Node))return[];let t=[e],i=[];while(t.length){let e=t.pop();if(e.hasRole(a["e"].EdgeTarget))i.push(e);else for(let i of e.children)t.push(i)}return i}}class c{constructor(e,t){this._object=e,this._parent=t}redo(){this._parent.addChild(this._object)}undo(){this._parent.removeChild(this._object.id,!0,!1)}}class d{constructor(e,t){this._object=e,this._anchor=t}redo(){this._anchor.addChild(this._object)}undo(){this._anchor.removeChild(this._object.id)}}var h,u=i("e37d");class p{constructor(e){if(!e.isAttached())throw new u["g"]("Object must be attached to an anchor.",e);this._object=e,this._anchor=e.anchor,this._index=e.getIndexInAnchor()}redo(){this._anchor.removeChild(this._object.id)}undo(){this._anchor.addChild(this._object,this._index)}}class g{constructor(e){this._actions=null!==e&&void 0!==e?e:[]}add(e){this._actions.push(e)}redo(){let e=0,t=this._actions.length;try{for(;e<t;e++)this._actions[e].redo()}catch(i){for(e--;0<=e;e--)this._actions[e].undo();throw i}}undo(){let e=this._actions.length-1;for(let t=e;0<=t;t--)this._actions[t].undo()}}class f{constructor(){this._undoStack=[],this._redoStack=[],this._transactions=[]}execute(e){Array.isArray(e)&&(e=new g(e)),this._transactions.length?this._transactions.at(-1).add(e):(e.redo(),this._redoStack=[],this._undoStack.push(e))}undo(){this._transactions=[],this._undoStack.length&&(this._undoStack.at(-1).undo(),this._redoStack.push(this._undoStack.pop()))}canUndo(){return 0<this._undoStack.length}redo(){this._transactions=[],this._redoStack.length&&(this._redoStack.at(-1).redo(),this._undoStack.push(this._redoStack.pop()))}canRedo(){return 0<this._redoStack.length}beginTransaction(){this._transactions.push(new g)}endTransaction(){if(!this._transactions.length)throw new Error("There are no open transactions.");this.execute(this._transactions.pop())}clearHistory(){this._undoStack=[],this._redoStack=[]}}class b{constructor(e,t){if(!e.parent)throw new u["g"]("Object must have a parent.",e);switch(this._object=e,this._parent=e.parent,this._prevIndex=e.getIndexInParent(),t){case h.Top:this._nextIndex=e.children.length;break;case h.OneAbove:this._nextIndex=this._prevIndex+1;break;case h.OneBelow:this._nextIndex=this._prevIndex-1;break;case h.Bottom:this._nextIndex=0;break}}redo(){this._parent.reorderChild(this._object.id,this._nextIndex)}undo(){this._parent.reorderChild(this._object.id,this._prevIndex)}}(function(e){e[e["Top"]=0]="Top",e[e["OneAbove"]=2]="OneAbove",e[e["OneBelow"]=3]="OneBelow",e[e["Bottom"]=4]="Bottom"})(h||(h={}));class m{constructor(e,t,i){this._object=e,this._dx=t,this._dy=i}redo(){this._object.moveBy(this._dx,this._dy)}undo(){this._object.moveBy(-this._dx,-this._dy)}}class _{constructor(e,t,i){this._object=e,this._lx=e.boundingBox.xMid,this._ly=e.boundingBox.yMid,this._nx=t,this._ny=i}redo(){this._object.moveTo(this._nx,this._ny)}undo(){this._object.moveTo(this._lx,this._ly)}}class v{constructor(...e){this._links=[],this._items=[];for(let i of e){if(!i.parent)throw new u["g"]("Object must have a parent.",i);this._items.push({index:i.getIndexInParent(),parent:i.parent,object:i})}let t=new Map;for(let i of this._items)for(let e of i.object.getSubtree())(e instanceof u["a"]||e instanceof u["b"])&&t.set(e.id,e);for(let i of t.values())if(i instanceof u["b"])i.isAttached()&&!t.has(i.anchor.id)&&this._links.push({index:i.getIndexInAnchor(),anchor:i.anchor,object:i});else if(i instanceof u["a"])for(let e of i.children)t.has(e.id)||this._links.push({index:e.getIndexInAnchor(),anchor:i,object:e})}redo(){for(let e of this._links)e.anchor.removeChild(e.object.id);for(let e of this._items)e.parent.removeChild(e.object.id,!0,!1)}undo(){for(let e of this._items)e.parent.addChild(e.object,e.index);for(let e of this._links)e.anchor.addChild(e.object,e.index)}}class y{constructor(e){this._obj=e}redo(){this._obj.setPositionSetByUser(s["j"].True)}undo(){this._obj.setPositionSetByUser(s["j"].False)}}class x{constructor(e){this.page=e,this._controller=new f}addObject(e,t=this.page.id){let i=this.page.lookup(t);if(!i)throw new Error(`Parent '${t}' does not exist.`);this._controller.execute(new c(e,i))}addLineObject(e,t,i,s=this.page.id){let o=this.page.lookup(s);if(!o)throw new Error(`Parent '${s}' does not exist.`);let n=new g;n.add(new c(e,o));let a=this.page.lookup(t),l=a instanceof r["b"];if(!l)throw new Error(`Invalid anchor '${t}'.`);{let{xMid:t,yMid:i}=a.boundingBox;n.add(new _(e.srcEnding,t,i)),n.add(new d(e.srcEnding,a))}if(i){let t=this.page.lookup(i),s=t instanceof r["b"];if(!s)throw new Error(`Invalid anchor '${i}'.`);{let{xMid:i,yMid:s}=t.boundingBox;n.add(new _(e.trgEnding,i,s)),n.add(new d(e.trgEnding,t))}}this._controller.execute(n)}removeObjects(...e){let t=[];for(let i of e){let e=this.page.lookup(i);if(!e)throw new Error(`'${i}' does not exist.`);t.push(e)}this._controller.execute(new v(...t))}attach(e,t){let i=this.page.lookup(e),s=this.page.lookup(t),o=i instanceof r["c"],n=s instanceof r["b"];if(!o||!n)throw new Error(`Invalid link '${e}' -> '${t}'.`);{let e=new g;i.isAttached()&&e.add(new p(i));let{xMid:t,yMid:o}=s.boundingBox;e.add(new _(i,t,o)),e.add(new d(i,s)),this._controller.execute(e)}}detach(e){let t=this.page.lookup(e),i=t instanceof r["c"];if(!i||!t.isAttached())throw new Error(`Invalid object '${e}'.`);this._controller.execute(new p(t))}moveObjectsBy(e,t,i){let s;if(Array.isArray(e)){s=new g;for(let o of e){let e=this.page.lookup(o);if(!e)throw new Error(`'${o}' does not exist.`);e.hasUserSetPosition()||s.add(new y(e)),s.add(new m(e,t,i))}}else{let o=this.page.lookup(e);if(!o)throw new Error(`'${e}' does not exist.`);s=o.hasUserSetPosition()?new m(o,t,i):new g([new y(o),new m(o,t,i)])}this._controller.execute(s)}moveObjectsTo(e,t,i){let s;if(Array.isArray(e)){s=new g;for(let o of e){let e=this.page.lookup(o);if(!e)throw new Error(`'${o}' does not exist.`);e.hasUserSetPosition()||s.add(new y(e)),s.add(new _(e,t,i))}}else{let o=this.page.lookup(e);if(!o)throw new Error(`'${e}' does not exist.`);s=o.hasUserSetPosition()?new _(o,t,i):new g([new y(o),new _(o,t,i)])}this._controller.execute(s)}reorderObjectLayer(e,t){let i=this.page.lookup(e);if(!i)throw new Error(`'${e}' does not exist.`);this._controller.execute(new b(i,t))}setCameraLocation(e){this.page.location=e}undo(){this._controller.undo()}canUndo(){return this._controller.canUndo()}redo(){this._controller.redo()}canRedo(){return this._controller.canRedo()}beginTransaction(){this._controller.beginTransaction()}endTransaction(){this._controller.endTransaction()}}class j{constructor(){this._scale=1,this._cache=new Map}createRaster(e,t,i,s=0){let o=new w(t,i,s,this._scale);return this._cache.set(e,o),o}drawRaster(e,t,i,s){let o=this._cache.get(t);return!!o&&(e.drawImage(o.canvas,i-o.cx,s-o.cy,o.w,o.h),!0)}setScale(e){this._scale=e,this._cache.clear()}getScale(){return this._scale}}class w{constructor(e,t,i,s){let o=i<<1;this.canvas=document.createElement("canvas"),this.canvas.width=Math.round((e+o)*s),this.canvas.height=Math.round((t+o)*s),this.context=this.canvas.getContext("2d"),this.context.setTransform(s,0,0,s,0,0),this.h=t+o,this.w=e+o,this.cx=Math.round(this.w/2),this.cy=Math.round(this.h/2),this.p=i}set fillStyle(e){this.context.fillStyle=e}set font(e){this.context.font=e}set lineWidth(e){this.context.lineWidth=e}set strokeStyle(e){this.context.strokeStyle=e}set textBaseline(e){this.context.textBaseline=e}beginPath(){this.context.beginPath()}closePath(){this.context.closePath()}moveTo(e,t){this.context.moveTo(this.p+e,this.p+t)}lineTo(e,t){this.context.lineTo(this.p+e,this.p+t)}stroke(){this.context.stroke()}fill(){this.context.fill()}fillText(e,t,i){this.context.fillText(e,t,i)}drawRect(e,t,i,s,o,n=1){e+=this.p+n/2,t+=this.p+n/2,i-=n,s-=n,o="number"===typeof o?{tl:o,tr:o,br:o,bl:o}:Object.assign({tl:0,tr:0,br:0,bl:0},o);let r=this.context;r.beginPath(),r.moveTo(e+o.tl,t),r.lineTo(e+i-o.tr,t),r.quadraticCurveTo(e+i,t,e+i,t+o.tr),r.lineTo(e+i,t+s-o.br),r.quadraticCurveTo(e+i,t+s,e+i-o.br,t+s),r.lineTo(e+o.bl,t+s),r.quadraticCurveTo(e,t+s,e,t+s-o.bl),r.lineTo(e,t+o.tl),r.quadraticCurveTo(e,t,e+o.tl,t),r.closePath()}}var k=i("898b");class O{constructor(){this.xMin=0,this.yMin=0,this.xMax=0,this.yMax=0,this.scale=1}}class S{constructor(e,t){this.dx=0,this.dy=0,this.ox=0,this.oy=0,this.odx=0,this.ody=0,this.anchor=void 0,this._cx=0,this._cy=0,this._cdx=0,this._cdy=0,this._alignment=s["a"].Free,this._gridX=e,this._gridY=t,this._anchors=[]}reset(e,t,i,s,o,n){this.dx=0,this.dy=0,this.ox=s,this.oy=o,this.odx=0,this.ody=0,this.anchor=void 0,this._cx=t,this._cy=i,this._cdx=0,this._cdy=0,this._alignment=e,this._anchors=null!==n&&void 0!==n?n:[]}updateDelta(e,t){this._cdx+=e,this._cdy+=t;let i,n,r,a,l=this._cx+this._cdx,c=this._cy+this._cdy;for(let s of this._anchors)if(a=s.boundingBox,i=s.radius,n=a.xMid-l,r=a.yMid-c,n*n+r*r<i*i)return this.dx=a.xMid-(this.ox+this.odx),this.dy=a.yMid-(this.oy+this.ody),this.odx+=this.dx,this.ody+=this.dy,void(this.anchor=s);switch(this.anchor=void 0,this._alignment){case s["a"].Grid:this.dx=Object(o["m"])(this._cdx,this._gridX)-this.odx,this.dy=Object(o["m"])(this._cdy,this._gridY)-this.ody;break;case s["a"].Free:default:this.dx=this._cdx-this.odx,this.dy=this._cdy-this.ody;break}this.odx+=this.dx,this.ody+=this.dy}}class M{constructor(){this.showGrid=!0,this.showShadows=!0,this.showDebug=!1,this.ssaaScale=1,this.shadowsDisableAt=0}}var T,A=i("a80d");class C extends o["a"]{constructor(){super();let e=r["m"].createDummy(),t=new j;this._canvas=null,this._context=null,this._display=new M,this._elWidth=0,this._elHeight=0,this._mover=new S(...e.grid),this._page=e.createView(t),this._rafId=0,this._rasterCache=t,this._resizeObserver=null,this._transform=k["e"],this._viewport=new O,this._ztoId=0,this._zoom=k["d"]().scaleExtent([1/8,6]).on("zoom",this.onCanvasZoom.bind(this)).on("end",e=>this.onCanvasZoomEnd(e)),this._hovObj=null}setPage(e){this._page=e.createView(this._rasterCache),this._mover=new S(...e.grid)}inject(e){this._elWidth=e.clientWidth,this._elHeight=e.clientHeight,this._canvas=k["c"](e).append("canvas").attr("style","display:block;").attr("width",this._elWidth).attr("height",this._elHeight).on("mousemove",e=>{this.onHoverSubject(...k["b"](e))}).on("contextmenu",e=>e.preventDefault()),this._context=this._canvas.node().getContext("2d",{alpha:!1}),this._resizeObserver=new ResizeObserver(e=>this.onCanvasResize(e[0].target)),this._resizeObserver.observe(e),this._canvas.call(k["a"]().filter(()=>!0).subject(this.onSelectSubject.bind(this)).on("start",this.onObjectDragStarted.bind(this)).on("drag",this.onObjectDragged.bind(this)).on("end",this.onObjectDragEnded.bind(this))).call(this._zoom),this.updateView(0)}destroy(){var e,t;null===(e=this._canvas)||void 0===e||e.remove(),this._canvas=null,this._context=null,this.removeAllListeners(),null===(t=this._resizeObserver)||void 0===t||t.disconnect()}on(e,t){super.on(e,t)}once(e,t){super.once(e,t)}removeAllListeners(e){super.removeAllListeners(e)}emit(e,...t){super.emit(e,...t)}setGridDisplay(e){this._display.showGrid=e}setShadowsDisplay(e){this._display.showShadows=e}setDebugDisplay(e){this._display.showDebug=e}setSsaaScale(e){this._display.ssaaScale=e,this._rasterCache.setScale(e)}setShadowsDisableAt(e){this._display.shadowsDisableAt=e}render(){0==this._rafId&&(this._rafId=requestAnimationFrame(()=>{this._rafId=0,this.executeRenderPipeline()}))}executeRenderPipeline(){if(null===this._context)return;let e=this._display;this._page.renderPageSurfaceTo(this._context,this._viewport,e.showGrid),e.showShadows&&e.shadowsDisableAt<=this._transform.k?this._page.renderTo(this._context,this._viewport):this._page.renderTo(this._context,this._viewport,0,0),e.showDebug&&this._page.renderDebugTo(this._context,this._viewport)}onHoverSubject(e,t,i){var o;e=this._transform.invertX(e),t=this._transform.invertY(t);let n=this._page.el.getObjectAt(e,t);this._hovObj!==n&&(this._hovObj=n,i=null!==(o=null!==i&&void 0!==i?i:null===n||void 0===n?void 0:n.getCursor())&&void 0!==o?o:s["c"].Default,this.emit("object-hover",n,i))}onSelectSubject(e){let t,i=e.sourceEvent,s=this._transform.invertX(e.x),n=this._transform.invertY(e.y),a=this._page.el.getObjectAt(s,n),l=i.button===o["d"].Right;if(a){if(a instanceof r["b"]){if(this.emit("canvas-click",i,e.x,e.y),l)return;let t=a.makeLine(),s=a.boundingBox.xMid,o=a.boundingBox.yMid;t.srcEnding.moveTo(s,o),t.trgEnding.moveTo(s,o);let n=t.createView(this._rasterCache).updateView();return{type:T.CreateLine,line:n,parent:this._page,anchor:a,obj:n.trgEnding}}if(a.parent instanceof r["d"]){if(this.emit("object-click",i,a.parent,e.x,e.y),l)return;t=[this._page.lookup(a.id)]}else{if(this.emit("object-click",i,a,e.x,e.y),l)return;t=this._page.selects}return t[0]instanceof A["c"]&&1===t.length?{type:T.MoveAnchorable,obj:t[0]}:{type:T.Move,objs:t}}this.emit("canvas-click",i,e.x,e.y)}onObjectDragStarted(e){let t=e.subject,i=this._transform.invertX(e.x),o=this._transform.invertY(e.y),n=0,r=0,a=s["a"].Free,l=void 0;switch(t.type){case T.Move:for(let e of t.objs)n+=e.x,r+=e.y,a=Math.max(a,e.el.getAlignment());n/=t.objs.length,r/=t.objs.length;break;case T.CreateLine:t.parent.children.push(t.line);case T.MoveAnchorable:n=t.obj.x,r=t.obj.y,a=t.obj.el.getAlignment(),l=this._page.el.anchorCache;break}this._mover.reset(a,i,o,n,r,l)}onObjectDragged(e){let t,i=e.subject;switch(this._mover.updateDelta(e.dx/this._transform.k,e.dy/this._transform.k),i.type){case T.Move:for(let e of i.objs)t=e.fakePositionSetByUser(s["j"].True),e.moveBy(this._mover.dx,this._mover.dy,t);break;case T.CreateLine:i.obj.el.moveBy(this._mover.dx,this._mover.dy);case T.MoveAnchorable:this.onHoverSubject(e.x,e.y,i.obj.el.getCursor()),t=i.obj.fakePositionSetByUser(s["j"].True),i.obj.moveBy(this._mover.dx,this._mover.dy,t);break}this.render()}onObjectDragEnded(e){let t=e.subject,i=this._mover.odx,s=this._mover.ody;switch(t.type){case T.Move:if(!i&&!s)return;let e=t.objs.map(e=>e.el);this.emit("object-move",e,i,s);break;case T.MoveAnchorable:if(!i&&!s)return;if(this._mover.anchor){let e=this._mover.anchor,i=t.obj.el;this.emit("object-attach",i,e)}else if(t.obj.el.isAttached()){let e=t.obj.el;this.emit("object-detach",e,i,s)}else{let e=[t.obj.el];this.emit("object-move",e,i,s)}break;case T.CreateLine:if((i||s)&&t.anchor!==this._mover.anchor){let e=t.line.el,i=t.parent.el,s=t.anchor,o=this._mover.anchor;this.emit("line-create",e,i,s,o)}else this.updateView(0);break}}onCanvasZoom(e){var t;this._transform.k!==e.transform.k&&(clearTimeout(this._ztoId),this._ztoId=setTimeout(()=>{let e=this._transform.k*this._display.ssaaScale;this._rasterCache.getScale()!==e&&(this._rasterCache.setScale(e),this.render())},C.RASTER_CACHE_UPDATE_DELAY)),this._transform=e.transform,this.updateViewportBounds(),null===(t=this._context)||void 0===t||t.setTransform(this._transform.k,0,0,this._transform.k,this._transform.x,this._transform.y),null===e.sourceEvent?0===this._rafId&&this.executeRenderPipeline():this.render()}onCanvasZoomEnd(e){this.emit("canvas-transform",this._transform.x,this._transform.y,this._transform.k);let[t,i]=this.getCameraOriginOffset();e.sourceEvent&&this.emit("camera-move",{type:r["l"].Point,x:(t-this._transform.x)/this._transform.k,y:(i-this._transform.y)/this._transform.k,k:this._transform.k})}onCanvasResize(e){var t,i,s;let o=e.clientWidth,n=e.clientHeight;this._transform.x+=(o-this._elWidth)/2,this._transform.y+=(n-this._elHeight)/2,this._elWidth=o,this._elHeight=n,null===(i=null===(t=this._canvas)||void 0===t?void 0:t.attr("width",this._elWidth))||void 0===i||i.attr("height",this._elHeight),this.updateViewportBounds(),null===(s=this._context)||void 0===s||s.setTransform(this._transform.k,0,0,this._transform.k,this._transform.x,this._transform.y),this._context&&this.executeRenderPipeline()}updateViewportBounds(){let e=this._transform,t=C.VIEWPORT_PADDING;this._viewport.xMin=Math.round(e.invertX(-t)),this._viewport.xMax=Math.round(e.invertX(this._elWidth+t)),this._viewport.yMin=Math.round(e.invertY(-t)),this._viewport.yMax=Math.round(e.invertY(this._elHeight+t)),this._viewport.scale=e.k}getCameraOriginOffset(){return[Math.round(this._elWidth/2),Math.round(this._elHeight/2)]}updateView(e=1e3){if(this._page.updateView(),!this._canvas)return;let{location:t}=this._page.el,[i,s,n]=[...this.getCameraOriginOffset(),1];switch(t.type){case r["l"].Point:n=t.k,i-=t.x*n,s-=t.y*n;break;case r["l"].Region:let e=t.w/this._elWidth,o=t.h/this._elHeight,a=Math.max(e,o);n=Math.min(.9/a,1.5),i=Math.round(i-t.x*n),s=Math.round(s-t.y*n);break}let a=this._transform;Object(o["i"])(a.x,i)&&Object(o["i"])(a.y,s)&&Object(o["i"])(a.k,n)?this.render():this._canvas.transition().duration(e).call(this._zoom.transform,k["e"].translate(i,s).scale(n))}}C.VIEWPORT_PADDING=0,C.RASTER_CACHE_UPDATE_DELAY=100,function(e){e[e["Move"]=0]="Move",e[e["MoveAnchorable"]=1]="MoveAnchorable",e[e["CreateLine"]=2]="CreateLine"}(T||(T={}));class B{constructor(e,t=30,i=!0,s=!0,o=!1){this._page=e,this._padding=t,this._showGrid=i,this._showShadows=s,this._showDebug=o}capture(e){let t,i,s,o;if(null===e||void 0===e?void 0:e.length){t=1/0,i=1/0,s=-1/0,o=-1/0;for(let n of e){let e=this._page.lookup(n);if(!e)throw new Error(`'${n}' does not exist.`);t=Math.min(t,e.boundingBox.xMin),i=Math.min(i,e.boundingBox.yMin),s=Math.max(s,e.boundingBox.xMax),o=Math.max(o,e.boundingBox.yMax)}}else t=this._page.boundingBox.xMin,i=this._page.boundingBox.yMin,s=this._page.boundingBox.xMax,o=this._page.boundingBox.yMax;let n=new j,r=this._page.createView(n);r.updateView();let a=document.createElement("canvas");a.width=Math.round(s-t)+2*this._padding,a.height=Math.round(o-i)+2*this._padding;let l=a.getContext("2d");l.setTransform(1,0,0,1,-t+this._padding,-i+this._padding);let c=new O;return c.xMin=t-this._padding,c.yMin=i-this._padding,c.xMax=s+this._padding,c.yMax=o+this._padding,r.renderPageSurfaceTo(l,c,this._showGrid),this._showShadows?r.renderTo(l,c):r.renderTo(l,c,0,0),this._showDebug&&r.renderDebugTo(l,c),a}}var P=i("9ab4"),R=i("9224");class D{constructor(e,t,i,s){this.name=e,this.factory=t,this.page=i,this.editor=new x(i),this.apiVersion=s}static createDummy(){return new this("@__builtin__dummy_document",a["c"].createDummy(),r["m"].createDummy(),"0.0.0")}static create(e,t){return Object(P["a"])(this,void 0,void 0,(function*(){let i=yield a["c"].create(t),s=i.createObject(t.page_template);return new this(e,i,s,R.version)}))}static deserialize(e){return Object(P["a"])(this,void 0,void 0,(function*(){e.constructor.name===String.name&&(e=JSON.parse(e)),e=e;let t=yield a["c"].create(e.schema),i=new Map;for(let n of e.objects)i.set(n.id,n);let s=i.get(e.page),o=function e(t,s,o,n){if(!o.has(t.id)){let r=[];for(let l of t.children)r.push(e(i.get(l),s,o,n));let a=n.createObject(Object.assign(Object.assign({},t),{children:r}));o.set(a.id,a)}return o.get(t.id)}(s,i,new Map,t);return new this(e.name,t,o,e.api_version)}))}toExport(){return{api_version:this.apiVersion,name:this.name,schema:this.factory.getSchema(),page:this.page.id,objects:[...this.page.getSubtree()].map(e=>e.toExport())}}}},"281e":function(e,t,i){"use strict";i("28d6")},"28d6":function(e,t,i){},"317b":function(e,t,i){"use strict";i.d(t,"d",(function(){return s})),i.d(t,"f",(function(){return o})),i.d(t,"e",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return u}));class s extends Error{constructor(e){super(e)}}var o,n,r;(function(e){e[e["AnchorPoint"]=0]="AnchorPoint",e[e["DictionaryBlock"]=1]="DictionaryBlock",e[e["LineEndingPoint"]=2]="LineEndingPoint",e[e["LineHandlePoint"]=3]="LineHandlePoint",e[e["LineHorizontalElbow"]=4]="LineHorizontalElbow",e[e["LineVerticalElbow"]=5]="LineVerticalElbow",e[e["Page"]=6]="Page",e[e["TextBlock"]=7]="TextBlock"})(o||(o={})),function(e){e[e["None"]=0]="None",e[e["Node"]=8192]="Node",e[e["Edge"]=16384]="Edge",e[e["EdgeSource"]=24576]="EdgeSource",e[e["EdgeTarget"]=32768]="EdgeTarget"}(n||(n={})),function(e){e[e["DEG_0"]=0]="DEG_0",e[e["DEG_90"]=1]="DEG_90"}(r||(r={}));const a="@__builtin__",l=[{id:a+"page",name:"Page",type:o.Page,role:n.None,grid:[10,10],style:{grid_color:"#1d1d1d",background_color:"#141414",drop_shadow:{color:"rgba(0,0,0,.4)",offset:[3,3]}}},{id:a+"anchor",name:"Anchor",type:o.AnchorPoint,role:n.None,radius:10,line_templates:{[r.DEG_0]:a+"line_horizontal_elbow",[r.DEG_90]:a+"line_vertical_elbow"},style:{color:"rgba(255, 255, 255, 0.25)"}},{id:a+"line_handle",name:"Line Handle",type:o.LineHandlePoint,role:n.None,style:{radius:6,fill_color:"#fedb22",stroke_color:"#141414",stroke_width:1.5}},{id:a+"line_source",name:"Line Source",type:o.LineEndingPoint,role:n.EdgeSource,style:{radius:6,fill_color:"#fedb22",stroke_color:"#141414",stroke_width:1.5}},{id:a+"line_target",name:"Line Target",type:o.LineEndingPoint,role:n.EdgeTarget,style:{radius:6,fill_color:"#fedb22",stroke_color:"#141414",stroke_width:1.5}},{id:a+"line_horizontal_elbow",name:"Horizontal Elbow",type:o.LineHorizontalElbow,role:n.Edge,hitbox_width:20,line_handle_template:a+"line_handle",line_ending_template:{source:a+"line_source",target:a+"line_target"},style:{width:5,cap_size:16,color:"#646464",select_colors:{solo_color:"#646464",many_color:"#646464"}}},{id:a+"line_vertical_elbow",name:"Vertical Elbow",type:o.LineVerticalElbow,role:n.Edge,hitbox_width:20,line_handle_template:a+"line_handle",line_ending_template:{source:a+"line_source",target:a+"line_target"},style:{width:5,cap_size:16,color:"#646464",select_colors:{solo_color:"#646464",many_color:"#646464"}}}];var c=i("9ab4"),d=i("13c3"),h=i("cbc0");class u{constructor(e,t){this.schema=e,this.templates=t}static createDummy(){return new this({page_template:"",templates:[]},new Map)}static create(e){return Object(c["a"])(this,void 0,void 0,(function*(){let t=structuredClone(e),i=new Set;for(let e of t.templates){if(i.has(e.id))throw new s(`Template '${e.id}' can only be defined once.`);i.add(e.id)}let o=new Map;for(let e of[...l,...t.templates])o.set(e.id,e);let n=[];for(let e of o.values())n=n.concat(this.getFontDescriptorsFromTemplate(e));yield d["c"].loadFonts(n);for(let e of o.values())this.swapFontDescriptorsWithFonts(e);return new this(e,o)}))}getTemplate(e){return this.templates.get(e)}getBlockTemplates(){let e=[];for(let t of this.templates.values())switch(t.type){case o.DictionaryBlock:e.push(t);break}return e}getLineTemplates(){let e=[];for(let t of this.templates.values())switch(t.type){case o.LineVerticalElbow:case o.LineHorizontalElbow:e.push(t);break}return e}createObject(e){let t,i;e instanceof Object?(t=e.template,i=e):t=e;let n=this.templates.get(t);if(!n)throw new s(`Template '${t}' does not exist.`);switch(n.type){case o.Page:return new h["m"](this,n,i);case o.AnchorPoint:return new h["a"](this,n,i);case o.DictionaryBlock:return new h["f"](this,n,i);case o.LineEndingPoint:return new h["h"](this,n,i);case o.LineHandlePoint:return new h["i"](this,n,i);case o.LineVerticalElbow:return new h["k"](this,n,i);case o.LineHorizontalElbow:return new h["j"](this,n,i);default:throw new s(`Unknown template type: '${n.type}'.`)}}cloneObjects(...e){let t=new Map,i=new Map,s=e.map(e=>this.cloneObject(e,t,i));for(let[o,n]of i)for(let e of n){let i=t.get(e);i&&o.addChild(i)}return s}cloneObject(e,t,i){if(e instanceof h["b"]){let s=this.createObject(Object.assign(Object.assign({},e.toExport()),{id:crypto.randomUUID(),children:[]}));return t.set(e.id,s),i.set(s,e.children.map(e=>e.id)),s}let s=[];for(let n of e.children)s.push(this.cloneObject(n,t,i));let o=this.createObject(Object.assign(Object.assign({},e.toExport()),{id:crypto.randomUUID(),children:s}));return t.set(e.id,o),o}static getFontDescriptorsFromTemplate(e){switch(e.type){case o.DictionaryBlock:let{style:t}=e;return[t.head.title.font,t.head.subtitle.font,t.body.field_name.font,t.body.field_value.font];default:return[]}}static swapFontDescriptorsWithFonts(e){let t=d["c"].getFont.bind(d["c"]);switch(e.type){case o.DictionaryBlock:let{head:i,body:s}=e.style;i.title.font=t(i.title.font),i.subtitle.font=t(i.subtitle.font),s.field_name.font=t(s.field_name.font),s.field_value.font=t(s.field_value.font);break;default:break}}getSchema(){let e=[];for(let t of this.templates.values()){let i=JSON.stringify(t,(e,t)=>t instanceof d["b"]?t.descriptor:t);e.push(JSON.parse(i))}return{page_template:this.schema.page_template,templates:e}}}},"360c":function(e,t,i){},"3c97":function(e,t,i){},"442f":function(e,t,i){"use strict";i("8d0a")},"4ebf":function(e,t,i){"use strict";i("3c97")},5368:function(e,t,i){"use strict";var s;i.d(t,"g",(function(){return s})),i.d(t,"f",(function(){return o})),i.d(t,"b",(function(){return n})),i.d(t,"h",(function(){return r})),i.d(t,"e",(function(){return a})),i.d(t,"a",(function(){return c})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return h})),function(e){e[e["Int"]=0]="Int",e[e["Float"]=1]="Float",e[e["String"]=2]="String",e[e["Date"]=3]="Date",e[e["Dropdown"]=4]="Dropdown",e[e["List"]=5]="List",e[e["Dictionary"]=6]="Dictionary"}(s||(s={}));class o{constructor(e){this.type=e.type,this.descriptor=e}static create(e,t){switch(e.type){case s.String:return new r(e,t);case s.Int:case s.Float:return new a(e,t);case s.Date:return new n(e,t);case s.List:return new h(e,t);case s.Dictionary:return new d(e,t);default:throw new Error(`Unknown property type: '${e.type}'.`)}}}class n extends o{constructor(e,t){super(e),this.descriptor=e,this.value="string"===typeof t?new Date(t):e.value}toRawValue(){return this.value.toISOString()}toString(){return""+this.value}}class r extends o{constructor(e,t){super(e),this.descriptor=e,this.value=""+(null!==t&&void 0!==t?t:e.value)}toRawValue(){return this.value}toString(){return this.value}}class a extends o{constructor(e,t){super(e),this.descriptor=e,this.value="number"===typeof t?t:e.value}toRawValue(){return this.value}toString(){return""+this.value}}var l=i("13c3");class c extends o{constructor(e){super(e),this.descriptor=e,this.value=new Map}getHash(){return Object(l["f"])([...this.value.values()].map(e=>e.toString()).join("."))}toRawValue(){return[...this.value.entries()].map(([e,t])=>[e,t.toRawValue()])}}class d extends c{constructor(e,t){var i;super(e),this.descriptor=e,this.value=new Map;for(let s in e.form){let n=null===(i=null===t||void 0===t?void 0:t.find(e=>e[0]===s))||void 0===i?void 0:i.at(1);this.value.set(s,o.create(e.form[s],n))}}toString(){var e,t;let i=this.descriptor.text_key;return null!==(t=null===(e=this.value.get(i))||void 0===e?void 0:e.toString())&&void 0!==t?t:`Unknown key: '${i}'`}}class h extends c{constructor(e,t){if(super(e),this.descriptor=e,this.value=new Map,Array.isArray(t))for(let[i,s]of t){let t=o.create(e.form,s);this.value.set(i,t)}else if(e.values)for(let i of e.values){let t=crypto.randomUUID(),s=o.create(e.form,i);this.value.set(t,s)}}addItem(){let e=crypto.randomUUID(),t=o.create(this.descriptor.form);this.value.set(e,t)}deleteItem(e){this.value.delete(e)}toString(){return[...this.value.values()].map(e=>e.toString()).join(", ")}}},"5dbc":function(e,t,i){"use strict";i("63e5")},"61f7":function(e,t,i){"use strict";i("1ce9")},"63e5":function(e,t,i){},"689d":function(e,t,i){"use strict";i("360c")},"69ee":function(e,t,i){"use strict";var s=i("7a23");const o={class:"object-field-contents-input"},n={class:"field-name"};function r(e,t,i,r,a,l){return Object(s["q"])(),Object(s["f"])("div",o,[(Object(s["q"])(!0),Object(s["f"])(s["a"],null,Object(s["w"])(e.property.value,([t,i])=>(Object(s["q"])(),Object(s["f"])("div",{class:"field-item",key:t},[Object(s["g"])("p",n,Object(s["A"])(e.titleCase(t)),1),(Object(s["q"])(),Object(s["d"])(Object(s["z"])(e.getField(i.type)),{property:i,align:e.align,onChange:e.onChange},null,40,["property","align","onChange"]))]))),128))])}var a=i("24a6");const l=Object(s["j"])(()=>i.e("chunk-4a96a04e").then(i.bind(null,"a23f"))),c=Object(s["j"])(()=>i.e("chunk-3b8130fb").then(i.bind(null,"2de3"))),d=Object(s["j"])(()=>i.e("chunk-46cf60ae").then(i.bind(null,"f090")));var h=Object(s["k"])({name:"DictionaryFieldContents",props:{property:{type:Object,required:!0},align:{type:String,default:"left"}},methods:{getField(e){switch(e){case a["n"].String:return"TextField";case a["n"].List:return"ListField";case a["n"].Dictionary:return"DictionaryField"}},onChange(e,t){this.$emit("change",e,t)},capitalize(e){return`${e[0].toLocaleUpperCase()}${e.substring(1)}`},titleCase(e){return e.split(/\s+|_/).map(e=>this.capitalize(e)).join(" ")}},emits:["change"],components:{TextField:l,ListField:c,DictionaryField:d}}),u=(i("835e"),i("6b0d")),p=i.n(u);const g=p()(h,[["render",r],["__scopeId","data-v-4e98de71"]]);t["a"]=g},"6e0f":function(e,t,i){},"738f":function(e,t,i){},"835e":function(e,t,i){"use strict";i("ceb6")},"8d0a":function(e,t,i){},9224:function(e){e.exports=JSON.parse('{"name":"attack-flow-builder","version":"0.1.0","private":true,"scripts":{"serve":"vue-cli-service serve","build":"vue-cli-service build"},"author":"mcarenzo","dependencies":{"vue":"^3.0.0","vuex":"^4.0.0-0"},"devDependencies":{"@types/d3":"^7.4.0","@types/resize-observer-browser":"^0.1.7","@vue/cli-plugin-typescript":"~4.5.15","@vue/cli-plugin-vuex":"~4.5.15","@vue/cli-service":"~4.5.15","@vue/compiler-sfc":"^3.0.0","d3":"^7.4.4","standard-version":"^9.3.2","typescript":"^4.1.5"},"browserslist":["> 1%","last 2 versions","not dead"]}')},"97e0":function(e,t,i){},"9ce6":function(e,t,i){},a5cb:function(e,t,i){},a80d:function(e,t,i){"use strict";i.d(t,"f",(function(){return o})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return a})),i.d(t,"e",(function(){return c})),i.d(t,"g",(function(){return d})),i.d(t,"i",(function(){return h})),i.d(t,"j",(function(){return u})),i.d(t,"k",(function(){return g})),i.d(t,"l",(function(){return f})),i.d(t,"a",(function(){return b})),i.d(t,"h",(function(){return m})),i.d(t,"m",(function(){return _}));var s=i("1dd9");class o{constructor(e,t){this.el=e,this.x=e.boundingBox.xMid,this.y=e.boundingBox.yMid,this.parent=void 0,this.children=[],this._rasterCache=t}*getSubtree(e){let t=new Set([this.el.id]),i=[this];while(0!=i.length){let s=i.shift();if(e&&!e(s)||(yield s),!(s instanceof n))for(let e of s.children)t.has(e.el.id)||(t.add(e.el.id),i.push(e))}}moveTo(e,t,i){this.moveBy(e-this.x,t-this.y)}moveBy(e,t,i){this.x+=e,this.y+=t;for(let s of this.children)s instanceof r&&s.el.isAttached()||s.moveBy(e,t)}renderTo(e,t,i=0,s=0,o){if(this.isVisible(t))for(let n of this.children)n.renderTo(e,t,i,s)}renderDebugTo(e,t){if(!this.isVisible(t))return;for(let s of this.children)s.renderDebugTo(e,t);let i=this.el.boundingBox;e.beginPath(),e.moveTo(i.xMin+.5,i.yMin+.5),e.lineTo(i.xMax-.5,i.yMin+.5),e.lineTo(i.xMax-.5,i.yMax-.5),e.lineTo(i.xMin+.5,i.yMax-.5),e.lineTo(i.xMin+.5,i.yMin+.5),e.lineTo(i.xMax-.5,i.yMax-.5),e.stroke()}isVisible(e){let{xMin:t,yMin:i,xMax:s,yMax:o}=this.el.boundingBox;return e.xMin<=s&&e.xMax>=t&&e.yMin<=o&&e.yMax>=i}updateView(){let e=new Array(this.el.children.length);for(let t=0;t<e.length;t++){let i=this.el.children[t].id,s=this.children.find(e=>e.el.id===i);e[t]=null!==s&&void 0!==s?s:this.el.children[t].createView(this._rasterCache),e[t].parent=this,e[t].updateView()}return this.children=e,this.x=this.el.boundingBox.xMid,this.y=this.el.boundingBox.yMid,this}fakeAlignment(e){return this.el.attrs&~s["b"]|e}fakeCursor(e){return this.el.attrs&~s["e"]|e}fakeHover(e){return this.el.attrs&~s["g"]|e}fakeInheritAlignment(e){return this.el.attrs&~s["i"]|e}fakePositionSetByUser(e){return this.el.attrs&~s["k"]|e}fakePriority(e){return this.el.attrs&~s["m"]|e}fakeSelect(e){return this.el.attrs&~s["o"]|e}}class n extends o{constructor(e,t){super(e,t),this.children=[],this.el=e}moveBy(e,t,i){this.x+=e,this.y+=t;for(let s of this.children)s.el.isAttached(this.el)?s.moveTo(this.x,this.y):console.warn(`'${s.el.id}' incorrectly attached to anchor.`)}updateView(){return this.x=this.el.boundingBox.xMid,this.y=this.el.boundingBox.yMid,this}}class r extends o{constructor(e,t){super(e,t),this.el=e}}class a extends r{constructor(e,t){super(e,t),this.el=e}moveBy(e,t,i,s=!1){var o;s?super.moveBy(e,t,i):null===(o=this.parent)||void 0===o||o.moveChild(this.el.id,e,t,i)}}class l extends o{constructor(e,t){super(e,t),this.el=e}moveBy(e,t,i,s=!1){var o;s?super.moveBy(e,t,i):null===(o=this.parent)||void 0===o||o.moveChild(this.el.id,e,t,i)}}class c extends o{constructor(e,t){super(e,t),this.el=e,this.children=[]}get srcEnding(){return this.children.at(0)}get trgEnding(){return this.children.at(-1)}}class d extends o{constructor(e,t){super(e,t),this.el=e,this._objectCache=new Map}renderDebugTo(e,t){e.save(),e.lineWidth=1,e.fillStyle="#00ff00",e.strokeStyle="#ffffff",e.setLineDash([2,2]),super.renderDebugTo(e,t),e.restore()}updateView(){super.updateView(),this._objectCache.clear();for(let e of this.getSubtree())this._objectCache.set(e.el.id,e);for(let e of this.el.anchorCache){let t=this.lookup(e.id);t.children=new Array(e.children.length);for(let i=0;i<t.children.length;i++){let s=e.children[i];t.children[i]=this.lookup(s.id),t.children[i].anchor=t}}return this}lookup(e){return this._objectCache.get(e)}}class h extends a{constructor(e,t){super(e,t),this.el=e}renderTo(e,t,i=0,s=0,o){let{radius:n,fill_color:r,stroke_color:a,stroke_width:l}=this.el.style;e.fillStyle=r,e.lineWidth=l,e.strokeStyle=a,e.beginPath(),e.arc(this.x,this.y,n,0,2*Math.PI),e.closePath(),e.fill(),e.stroke()}}class u extends l{constructor(e,t){super(e,t),this.el=e}renderTo(e,t,i=0,s=0,o){let{radius:n,fill_color:r,stroke_color:a,stroke_width:l}=this.el.style;e.fillStyle=r,e.lineWidth=l,e.strokeStyle=a;let c=l%2?.5:0;e.beginPath(),e.arc(this.x,this.y,n+c,0,2*Math.PI),e.closePath(),e.fill(),e.stroke()}}var p=i("13c3");class g extends c{constructor(e,t){super(e,t),this.el=e}moveChild(e,t,i,s){let o=this.children.find(t=>t.el.id===e);if(!o)return;o instanceof a&&o.moveBy(t,i,void 0,!0);let[n,r,l]=this.children,c=(n.x+l.x)/2-r.x,d=(n.y+l.y)/2-r.y;r.el.hasUserSetPosition(o===r?s:void 0)?o===r&&r.moveBy(t,0,void 0,!0):r.moveBy(c,0,void 0,!0),r.moveBy(0,d,void 0,!0)}renderTo(e,t,i=0,o=0,n){if(!this.isVisible(t))return;let r,{children:a}=this,{cap_size:l,width:c,color:d,select_colors:h}=this.el.style;switch(e.lineWidth=c,this.el.attrs&s["o"]){case s["n"].Single:r=h.solo_color;break;case s["n"].Multi:r=h.many_color;break;case s["n"].Unselected:default:r=d;break}e.fillStyle=r,e.strokeStyle=r;let u=c%2?.5:0,g=Math.sign(a[2].x-a[1].x)*(l>>1);e.beginPath(),e.moveTo(a[0].x,a[0].y+u),e.lineTo(a[1].x+u,a[0].y+u),e.lineTo(a[1].x+u,a[2].y+u),e.lineTo(a[2].x-g,a[2].y+u),e.stroke(),Object(p["g"])(e,a[1].x,a[2].y+u,a[2].x,a[2].y+u,l),e.fill(),this.el.isSelected(n)&&super.renderTo(e,t,i,o)}renderDebugTo(e,t){if(!this.isVisible(t))return;let i=2,s=2*Math.PI;e.beginPath();for(let o of this.el.hitboxes)for(let t=0;t<o.length;t+=2)e.moveTo(o[t]+i,o[t+1]),e.arc(o[t],o[t+1],i,0,s);e.fill(),super.renderDebugTo(e,t)}}class f extends c{constructor(e,t){super(e,t),this.el=e}moveChild(e,t,i,s){let o=this.children.find(t=>t.el.id===e);if(!o)return;o instanceof a&&o.moveBy(t,i,void 0,!0);let[n,r,l]=this.children,c=(n.x+l.x)/2-r.x,d=(n.y+l.y)/2-r.y;r.el.hasUserSetPosition(o===r?s:void 0)?o===r&&r.moveBy(0,i,void 0,!0):r.moveBy(0,d,void 0,!0),r.moveBy(c,0,void 0,!0)}renderTo(e,t,i=0,o=0,n){if(!this.isVisible(t))return;let r,{children:a}=this,{cap_size:l,width:c,color:d,select_colors:h}=this.el.style;switch(e.lineWidth=c,this.el.attrs&s["o"]){case s["n"].Single:r=h.solo_color;break;case s["n"].Multi:r=h.many_color;break;case s["n"].Unselected:default:r=d;break}e.fillStyle=r,e.strokeStyle=r;let u=c%2?.5:0,g=Math.sign(a[1].y-a[2].y)*(l>>1);e.beginPath(),e.moveTo(a[0].x+u,a[0].y),e.lineTo(a[0].x+u,a[1].y+u),e.lineTo(a[2].x+u,a[1].y+u),e.lineTo(a[2].x+u,a[2].y+g),e.stroke(),Object(p["g"])(e,a[2].x+u,a[1].y,a[2].x+u,a[2].y,l),e.fill(),this.el.isSelected(n)&&super.renderTo(e,t,i,o)}renderDebugTo(e,t){if(!this.isVisible(t))return;let i=2,s=2*Math.PI;e.beginPath();for(let o of this.el.hitboxes)for(let t=0;t<o.length;t+=2)e.moveTo(o[t]+i,o[t+1]),e.arc(o[t],o[t+1],i,0,s);e.fill(),super.renderDebugTo(e,t)}}class b extends n{constructor(e,t){super(e,t),this.el=e}renderTo(e,t,i=0,s=0,o){this.el.isHovered(o)&&(e.fillStyle=this.el.style.color,e.beginPath(),e.arc(this.x,this.y,this.el.radius,0,2*Math.PI),e.closePath(),e.fill())}}class m extends o{constructor(e,t){super(e,t),this.el=e,this.tlx=0,this.tly=0}moveBy(e,t,i){super.moveBy(e,t),this.tlx+=e,this.tly+=t}renderTo(e,t,i=0,o=0,n){if(!this.isVisible(t))return;let{tlx:r,tly:a}=this,{body:l,head:c,select_outline:d,border_radius:h}=this.el.style,{width:u,height:g,headHeight:f}=this.el.layout;e.lineWidth=1.1,i|o?(Object(p["h"])(e,r,a,u,g,h),e.shadowOffsetX=i+.5*t.scale,e.shadowOffsetY=o+.5*t.scale,e.fillStyle=l.fill_color,e.strokeStyle=l.stroke_color,e.fill(),e.shadowOffsetX=0,e.shadowOffsetY=0,e.stroke()):(Object(p["h"])(e,r,a+f-1,u,g-f+1,{br:h,bl:h}),e.fillStyle=l.fill_color,e.strokeStyle=l.stroke_color,e.fill(),e.stroke()),Object(p["h"])(e,r,a,u,f,{tr:h,tl:h}),e.fillStyle=c.fill_color,e.strokeStyle=c.stroke_color,e.fill(),e.stroke();let b=c.title;e.font=b.font.css,e.fillStyle=b.color;for(let s of this.el.layout.titleFont)e.fillText(s.t,r+s.x,a+s.y);let m=c.subtitle;e.font=m.font.css,e.fillStyle=m.color;for(let s of this.el.layout.subtitleFont)e.fillText(s.t,r+s.x,a+s.y);let _=l.field_name;e.font=_.font.css,e.fillStyle=_.color;for(let s of this.el.layout.fieldNameFont)e.fillText(s.t,r+s.x,a+s.y);let v=l.field_value;e.font=v.font.css,e.fillStyle=v.color;for(let s of this.el.layout.fieldValueFont)e.fillText(s.t,r+s.x,a+s.y);if(this.el.isSelected(n)){let{padding:t,solo_color:i,many_color:o,border_radius:n}=d;switch(t+=1,Object(p["h"])(e,r-t,a-t,u+2*t,g+2*t,n,1),this.el.attrs&s["o"]){case s["n"].Single:e.strokeStyle=i;break;case s["n"].Multi:e.strokeStyle=o;break}e.stroke()}else if(this.el.isHovered(n)){let{color:s,size:n}=this.el.style.anchor_markers;super.renderTo(e,t,i,o),e.strokeStyle=s,e.beginPath();for(let t of this.children)e.moveTo(t.x-n,t.y-n),e.lineTo(t.x+n,t.y+n),e.moveTo(t.x+n,t.y-n),e.lineTo(t.x-n,t.y+n);e.stroke()}}updateView(){return super.updateView(),this.tlx=this.el.boundingBox.xMin+this.el.layout.dx,this.tly=this.el.boundingBox.yMin+this.el.layout.dy,this}}class _ extends d{constructor(e,t){super(e,t),this.el=e;let{grid_color:i,background_color:s}=this.el.style;this._gridPattern=this.createGridPattern(...this.el.grid,s,i)}get selects(){return[...this.getSubtree(e=>e.el.isSelected())]}renderPageSurfaceTo(e,t,i){e.fillStyle=i?this._gridPattern:this.el.style.background_color,e.fillRect(t.xMin,t.yMin,t.xMax-t.xMin,t.yMax-t.yMin)}renderTo(e,t,i=this.el.style.drop_shadow.offset[0],s=this.el.style.drop_shadow.offset[1],o){e.shadowColor=this.el.style.drop_shadow.color,super.renderTo(e,t,i*t.scale,s*t.scale)}createGridPattern(e,t,i,s){let o=document.createElement("canvas"),n=o.getContext("2d",{alpha:!1});o.width=e,o.height=t,n.fillStyle=i,n.lineWidth=2,n.strokeStyle=s,n.fillRect(0,0,e,t),n.moveTo(0,0),n.lineTo(0,t),n.lineTo(e,t),n.stroke();let r=n.createPattern(o,"repeat");return r.setTransform((new DOMMatrix).translate(0,1)),r}}},b17c:function(e,t,i){},c4f4:function(e,t,i){"use strict";i("6e0f")},cbc0:function(e,t,i){"use strict";i.d(t,"e",(function(){return s["f"]})),i.d(t,"g",(function(){return s["i"]})),i.d(t,"b",(function(){return s["a"]})),i.d(t,"c",(function(){return s["b"]})),i.d(t,"d",(function(){return s["e"]})),i.d(t,"h",(function(){return r})),i.d(t,"i",(function(){return a})),i.d(t,"j",(function(){return c})),i.d(t,"k",(function(){return d})),i.d(t,"a",(function(){return h})),i.d(t,"f",(function(){return g})),i.d(t,"m",(function(){return f})),i.d(t,"l",(function(){return u}));var s=i("e37d"),o=i("a80d"),n=i("1dd9");class r extends s["c"]{constructor(e,t,i){super(e,t,i),this.setCursor(n["c"].Pointer),this.setSemanticRole(t.role),this.template=t,this.style=t.style,this.updateLayout(s["i"].ObjectInit)}getObjectAt(e,t){let i=e-this.boundingBox.xMid,s=t-this.boundingBox.yMid,o=this.style.radius;return i*i+s*s<o*o?this:void 0}updateLayout(e,t=!0){var i;let s=this.boundingBox;s.xMin=s.xMid-this.style.radius,s.yMin=s.yMid-this.style.radius,s.xMax=s.xMid+this.style.radius,s.yMax=s.yMid+this.style.radius,t&&(null===(i=this.parent)||void 0===i||i.updateLayout(e))}createView(e){return new o["i"](this,e)}}class a extends s["d"]{constructor(e,t,i){super(e,t,i),this.setCursor(n["c"].Move),this.setSemanticRole(t.role),this.template=t,this.style=t.style,this.updateLayout(s["i"].ObjectInit)}getObjectAt(e,t){let i=e-this.boundingBox.xMid,s=t-this.boundingBox.yMid,o=this.style.radius;return i*i+s*s<o*o?this:void 0}updateLayout(e,t=!0){var i;let s=this.boundingBox;s.xMin=s.xMid-this.style.radius,s.yMin=s.yMid-this.style.radius,s.xMax=s.xMid+this.style.radius,s.yMax=s.yMid+this.style.radius,t&&(null===(i=this.parent)||void 0===i||i.updateLayout(e))}createView(e){return new o["j"](this,e)}}var l=i("13c3");class c extends s["e"]{constructor(e,t,i){if(super(e,t,i),this.hitboxes=[[],[],[]],this.setCursor(n["c"].Move),this.setSemanticRole(t.role),this.template=t,!this.children.length){let i=this.boundingBox.xMid,s=this.boundingBox.yMid,o=t.line_ending_template.source,n=t.line_handle_template,r=t.line_ending_template.target;this.addChild(e.createObject(o),0,!1),this.addChild(e.createObject(n),1,!1),this.addChild(e.createObject(r),2,!1);for(let e of this.children)e.moveTo(i,s);this.children[0].moveBy(-100,50),this.children[2].moveBy(100,-50)}this.updateLayout(s["i"].ObjectInit)}getObjectAt(e,t){if(this.isAnchored()){let i=super.getObjectAt(e,t);if(i)return i;for(let s=0;s<this.hitboxes.length;s++)if(Object(l["l"])(e,t,this.hitboxes[s]))return 1===s?this.children[s]:this}else{if(this.isSelected()){let i=super.getObjectAt(e,t);if(i)return i}for(let i of this.hitboxes)if(Object(l["l"])(e,t,i))return this}}moveChild(e,t,i,s=!0){let o=this.children.find(t=>t.id===e);if(!o)return;o instanceof r&&o.moveBy(t,i,s,!0);let[n,a,l]=this.children,c=n.boundingBox.xMid,d=n.boundingBox.yMid,h=l.boundingBox.xMid,u=l.boundingBox.yMid,p=a.boundingBox.xMid,g=a.boundingBox.yMid,f=(c+h)/2-p,b=(d+u)/2-g;a.hasUserSetPosition()?o===a&&a.moveBy(t,0,s,!0):a.moveBy(f,0,s,!0),a.moveBy(0,b,s,!0)}updateLayout(e,t=!0){let[i,s,o]=this.children.map(e=>e.boundingBox),r=this.hitboxWidth;this.hitboxes[0]=Object(l["k"])(i.xMid,i.yMid,s.xMid,i.yMid,r),this.hitboxes[1]=Object(l["k"])(s.xMid,i.yMid,s.xMid,o.yMid,r),this.hitboxes[2]=Object(l["k"])(s.xMid,o.yMid,o.xMid,o.yMid,r),this.children[1].setCursor(n["c"].Col_Resize),super.updateLayout(e,t)}createView(e){return new o["k"](this,e)}}class d extends s["e"]{constructor(e,t,i){if(super(e,t,i),this.hitboxes=[[],[],[]],this.setCursor(n["c"].Move),this.setSemanticRole(t.role),this.template=t,!this.children.length){let i=this.boundingBox.xMid,s=this.boundingBox.yMid,o=t.line_ending_template.source,n=t.line_handle_template,r=t.line_ending_template.target;this.addChild(e.createObject(o),0,!1),this.addChild(e.createObject(n),1,!1),this.addChild(e.createObject(r),2,!1);for(let e of this.children)e.moveTo(i,s);this.children[0].moveBy(-50,100),this.children[2].moveBy(50,-100)}this.updateLayout(s["i"].ObjectInit)}getObjectAt(e,t){if(this.isAnchored()){let i=super.getObjectAt(e,t);if(i)return i;for(let s=0;s<this.hitboxes.length;s++)if(Object(l["l"])(e,t,this.hitboxes[s]))return 1===s?this.children[s]:this}else{if(this.isSelected()){let i=super.getObjectAt(e,t);if(i)return i}for(let i of this.hitboxes)if(Object(l["l"])(e,t,i))return this}}moveChild(e,t,i,s=!0){let o=this.children.find(t=>t.id===e);if(!o)return;o instanceof r&&o.moveBy(t,i,s,!0);let[n,a,l]=this.children,c=n.boundingBox.xMid,d=n.boundingBox.yMid,h=l.boundingBox.xMid,u=l.boundingBox.yMid,p=a.boundingBox.xMid,g=a.boundingBox.yMid,f=(c+h)/2-p,b=(d+u)/2-g;a.hasUserSetPosition()?o===a&&a.moveBy(0,i,s,!0):a.moveBy(0,b,s,!0),a.moveBy(f,0,s,!0)}updateLayout(e,t=!0){let[i,s,o]=this.children.map(e=>e.boundingBox),r=this.hitboxWidth;this.hitboxes[0]=Object(l["k"])(i.xMid,i.yMid,i.xMid,s.yMid,r),this.hitboxes[1]=Object(l["k"])(i.xMid,s.yMid,o.xMid,s.yMid,r),this.hitboxes[2]=Object(l["k"])(o.xMid,s.yMid,o.xMid,o.yMid,r),this.children[1].setCursor(n["c"].Row_Resize),super.updateLayout(e,t)}createView(e){return new o["l"](this,e)}}class h extends s["a"]{constructor(e,t,i){super(e,t,i),this.setSemanticRole(t.role),this.template=t,this.style=t.style,this.updateLayout(s["i"].ObjectInit)}updateLayout(e,t=!0){var i;let s=this.boundingBox;s.xMin=s.xMid-this.radius,s.yMin=s.yMid-this.radius,s.xMax=s.xMid+this.radius,s.yMax=s.yMid+this.radius,t&&(null===(i=this.parent)||void 0===i||i.updateLayout(e))}createView(e){return new o["a"](this,e)}}var u,p=i("317b");class g extends s["f"]{constructor(e,t,i){if(super(e,t,i),this.setInheritAlignment(n["h"].False),this.setAlignment(n["a"].Grid),this.setCursor(n["c"].Move),this.layout={},this.setSemanticRole(t.role),this.template=t,this.style=t.style,!this.children.length){let i=t.anchor_template,s=[p["a"].DEG_90,p["a"].DEG_0];for(let t,o=0;o<12;o++)t=e.createObject(i),t.angle=s[Math.floor(o/3)%2],this.addChild(t,o,!1)}this.updateLayout(s["i"].ObjectInit)}getObjectAt(e,t){let i=super.getObjectAt(e,t);if(i)return i;let s=this.boundingBox;return s.xMin<=e&&e<=s.xMax&&s.yMin<=t&&t<=s.yMax?this:void 0}updateLayout(e,t=!0){var i,s;let o=this.props.getHash();if(this.layout.contentHash!==o){let{max_width:t,head:s,body:n,horizontal_padding:r}=this.style,a=s.title,l=s.subtitle,c=n.field_name,d=n.field_value,h=1,u=[],p=[],g=[],f=[],b=this.template.title_key,m=this.props.value.get(b),_=this.template.id.toLocaleUpperCase(),v=null!==(i=null===m||void 0===m?void 0:m.toString())&&void 0!==i?i:`Unknown key: '${b}'`,y=t;y=Math.max(y,s.title.font.measureWidth(_));for(let e of this.props.value.keys())y=Math.max(y,n.field_name.font.measureWidth(e));let x=null,j=0,w=h+r,k=h+s.vertical_padding;x=a.font.measure(_),j=Math.max(j,x.width),k+=x.ascent,u.push({x:w,y:k,t:_}),k+=x.descent+s.title.padding;let O=l.font.wordWrap(v,y);x=l.font.measure(O[0]),j=Math.max(j,x.width),k+=x.ascent,p.push({x:w,y:k,t:O[0]});for(let e=1;e<O.length;e++)x=l.font.measure(O[e]),j=Math.max(j,x.width),k+=l.lineHeight,p.push({x:w,y:k,t:O[e]});k+=s.vertical_padding+h;let S=Math.round(k);k+=n.vertical_padding;for(let[e,i]of this.props.value){if(e===this.template.title_key)continue;e=e.toLocaleUpperCase(),x=c.font.measure(e),j=Math.max(j,x.width),k+=x.ascent,g.push({x:w,y:k,t:e}),k+=x.descent+n.field_name.padding;let t=d.font.wordWrap(""+i.toString(),y);x=d.font.measure(t[0]),j=Math.max(j,x.width),k+=x.ascent,f.push({x:w,y:k,t:t[0]});for(let e=1;e<t.length;e++)x=d.font.measure(t[e]),j=Math.max(j,x.width),k+=d.line_height,f.push({x:w,y:k,t:t[e]});k+=n.field_value.padding}k-=n.field_value.padding;let M=Math.round(2*(r+h)+j),T=Math.round(k+n.vertical_padding+h),A=this.boundingBox,C=Math.round(A.xMid-M/2),B=Math.round(A.yMid-T/2),P=Math.round(A.xMid+M/2),R=Math.round(A.yMid+T/2),D=(A.xMid-C)/2,E=(A.yMid-B)/2,L=[A.xMid-D,B,A.xMid,B,A.xMid+D,B,P,A.yMid-E,P,A.yMid,P,A.yMid+E,A.xMid+D,R,A.xMid,R,A.xMid-D,R,C,A.yMid+E,C,A.yMid,C,A.yMid-E];for(let e=0;e<L.length;e+=2)this.children[e/2].moveTo(L[e],L[e+1],!1);super.updateLayout(e,!1),this.layout={contentHash:o,dx:C-A.xMin,dy:B-A.yMin,width:M,height:T,headHeight:S,titleFont:u,subtitleFont:p,fieldNameFont:g,fieldValueFont:f}}t&&(null===(s=this.parent)||void 0===s||s.updateLayout(e))}createView(e){return new o["h"](this,e)}}class f extends s["h"]{constructor(e,t,i){var o;super(e,t,i),this.setSemanticRole(t.role),this.template=t,this.grid=t.grid,this.style=t.style,this.location=null!==(o=null===i||void 0===i?void 0:i.location)&&void 0!==o?o:{type:u.Point,x:0,y:0,k:1},this.updateLayout(s["i"].ObjectInit)}static createDummy(){return new this(p["c"].createDummy(),{id:"",name:"",type:p["f"].Page,role:p["e"].None,grid:[10,10],style:{grid_color:"#1d1d1d",background_color:"#141414",drop_shadow:{color:"rgba(0,0,0,.4)",offset:[3,3]}}})}createView(e){return new o["m"](this,e)}toExport(){return Object.assign(Object.assign({},super.toExport()),{location:this.location})}}(function(e){e[e["Point"]=0]="Point",e[e["Region"]=1]="Region"})(u||(u={}))},cd49:function(e,t,i){"use strict";i.r(t);var s=i("7a23");const o={id:"app-body"};function n(e,t,i,n,r,a){const l=Object(s["y"])("AppTitleBar"),c=Object(s["y"])("BlockDiagram"),d=Object(s["y"])("EditorTabs"),h=Object(s["y"])("AppFooterBar"),u=Object(s["y"])("AppHotkeyBox");return Object(s["q"])(),Object(s["d"])(u,{id:"main"},{default:Object(s["F"])(()=>[Object(s["i"])(l,{id:"app-title-bar"}),Object(s["g"])("div",o,[Object(s["i"])(c,{id:"block-diagram"}),Object(s["i"])(d,{id:"app-tabs"}),Object(s["i"])(h,{id:"app-footer-bar"})])]),_:1})}var r=i("9ab4"),a=i("5502");class l{constructor(){this._errors=[]}run(e){this.reset(),this.validate(e)}validate(e){}getErrors(){return this._errors}addError(e,t){this._errors.push({object:e.id,reason:t})}inValidState(){return 0===this._errors.length}reset(){this._errors=[]}}var c=i("24a6");class d extends l{validate(e){let t=c["p"].toGraph(e);for(let i of t.edges)1===i.prev.length&&1===i.next.length||this.addError(i,"Everything should be connected")}}var h=d;class u{publish(e){return""}}class p extends u{publish(e){c["p"].toGraph(e);return console.log("DID IT!"),""}}var g=p,f=i("5368"),b=i("317b");const m={max_width:320,head:{fill_color:"#000",stroke_color:"#000",title:{font:{family:"Inter",size:"8pt",weight:600},color:"#d8d8d8",padding:8},subtitle:{font:{family:"Inter",size:"13pt",weight:800},color:"#d8d8d8",lineHeight:23},vertical_padding:14},body:{fill_color:"#1f1f1f",stroke_color:"#383838",field_name:{font:{family:"Inter",size:"8pt",weight:600},color:"#b3b3b3",padding:12},field_value:{font:{family:"Inter",size:"10.5pt"},color:"#bfbfbf",line_height:20,padding:22},vertical_padding:18},select_outline:{padding:4,solo_color:"#e6d845",many_color:"#e6d845",border_radius:9},anchor_markers:{color:"#ffffff",size:3},border_radius:5,horizontal_padding:20},_=structuredClone(m);_.head.fill_color="#637bc9",_.head.stroke_color="#708ce6";const v=structuredClone(m);v.head.fill_color="#c26130",v.head.stroke_color="#e57339";const y=structuredClone(m);y.head.fill_color="#2a9642",y.head.stroke_color="#32b34e";const x={file_type_name:"Attack Flow",file_type_extension:"afb",schema:{page_template:"@__builtin__page",templates:[{id:"action",name:"Action Block",type:b["f"].DictionaryBlock,role:b["e"].Node,title_key:"technique_name",properties:{spec_version:{type:f["g"].String,value:"2.1"},technique_id:{type:f["g"].String,value:""},technique_name:{type:f["g"].String,value:""},technique_ref:{type:f["g"].String,value:""},description:{type:f["g"].String,value:""}},anchor_template:"@__builtin__anchor",style:_},{id:"asset",name:"Asset Block",type:b["f"].DictionaryBlock,role:b["e"].Node,title_key:"name",properties:{spec_version:{type:f["g"].String,value:"2.1"},name:{type:f["g"].String,value:""},description:{type:f["g"].String,value:""}},anchor_template:"@__builtin__anchor",style:v},{id:"condition",name:"Condition Block",type:b["f"].DictionaryBlock,role:b["e"].Node,title_key:"description",properties:{spec_version:{type:f["g"].String,value:"2.1"},description:{type:f["g"].String,value:""},pattern:{type:f["g"].String,value:""},pattern_type:{type:f["g"].String,value:""},pattern_version:{type:f["g"].String,value:""}},anchor_template:"@__builtin__anchor",style:y}]},help_links:[{text:"Attack Flow GitHub",url:"https://github.com/center-for-threat-informed-defense/attack-flow"},{text:"MITRE ATT&CK Framework",url:"https://attack.mitre.org/"}],validator:h,publisher:g};var j=x;const w=e=>(Object(s["t"])("data-v-34dfc6e8"),e=e(),Object(s["r"])(),e),k=w(()=>Object(s["g"])("span",{class:"logo"},"AFB",-1));function O(e,t,i,o,n,r){const a=Object(s["y"])("TitleBar");return Object(s["q"])(),Object(s["d"])(a,{class:"app-title-bar-element",menus:e.menus,onSelect:e.onItemSelect},{icon:Object(s["F"])(()=>[k]),_:1},8,["menus","onSelect"])}const S={class:"icon"},M=["onMouseenter","onClick"];function T(e,t,i,o,n,r){const a=Object(s["y"])("ContextMenuListing"),l=Object(s["y"])("FocusBox");return Object(s["q"])(),Object(s["d"])(l,{class:"title-bar-control",onUnfocus:e.menuClose},{default:Object(s["F"])(()=>[Object(s["g"])("li",S,[Object(s["x"])(e.$slots,"icon",{},void 0,!0)]),(Object(s["q"])(!0),Object(s["f"])(s["a"],null,Object(s["w"])(e.menus,i=>(Object(s["q"])(),Object(s["f"])("li",{key:i.id,class:Object(s["o"])({focused:i.id===e.focusedMenu}),onMouseenter:t=>e.menuEnter(i.id),onClick:t=>e.menuOpen(i.id)},[Object(s["g"])("p",null,Object(s["A"])(i.text),1),i.id===e.focusedMenu?(Object(s["q"])(),Object(s["d"])(a,{key:0,class:"menu-listing",sections:i.sections,select:e.menuSelect,onClick:t[0]||(t[0]=Object(s["H"])(()=>{},["stop"]))},null,8,["sections","select"])):Object(s["e"])("",!0)],42,M))),128))]),_:3},8,["onUnfocus"])}function A(e,t,i,o,n,r){return Object(s["q"])(),Object(s["f"])("div",{onClick:t[0]||(t[0]=t=>e.$emit("focus")),class:"focus-box-container"},[Object(s["x"])(e.$slots,"default")])}var C=Object(s["k"])({name:"FocusBox",data(){return{onFocusOut:function(e){this.$el==e.target||this.$el.contains(e.target)||this.$emit("unfocus")}.bind(this)}},emits:["focus","unfocus"],mounted(){setTimeout(()=>{document.body.addEventListener("pointerdown",this.onFocusOut)},0)},unmounted(){document.body.removeEventListener("pointerdown",this.onFocusOut)}}),B=i("6b0d"),P=i.n(B);const R=P()(C,[["render",A]]);var D=R;const E=e=>(Object(s["t"])("data-v-431fe6dc"),e=e(),Object(s["r"])(),e),L=["onMouseenter"],I={class:"item"},F={class:"text"},H=E(()=>Object(s["g"])("span",{class:"more-arrow"},null,-1)),z={key:0,class:"submenu"},V=["onClick"],q=["href"],$={class:"check"},U={class:"text"},N={key:0,class:"shortcut"},G={key:0,class:"section-divider"};function W(e,t,i,o,n,r){const a=Object(s["y"])("ContextMenuListing",!0);return Object(s["q"])(),Object(s["f"])("div",{class:"context-menu-listing-control",style:Object(s["p"])(e.offset),onContextmenu:t[2]||(t[2]=Object(s["H"])(()=>{},["prevent"]))},[Object(s["g"])("input",{type:"file",ref:"file",style:{display:"none"},onChange:t[0]||(t[0]=(...t)=>e.readFile&&e.readFile(...t))},null,544),(Object(s["q"])(!0),Object(s["f"])(s["a"],null,Object(s["w"])(e.sections,(i,o)=>(Object(s["q"])(),Object(s["f"])("div",{class:"section",key:i.name},[(Object(s["q"])(!0),Object(s["f"])(s["a"],null,Object(s["w"])(i.items,i=>(Object(s["q"])(),Object(s["f"])(s["a"],{key:i.id},[i.action===e.MenuAction.OpenSubmenu?(Object(s["q"])(),Object(s["f"])("li",{key:0,class:Object(s["o"])({disabled:i.disabled}),onMouseenter:t=>e.submenuEnter(i),onMouseleave:t[1]||(t[1]=(...t)=>e.submenuLeave&&e.submenuLeave(...t))},[Object(s["g"])("a",I,[Object(s["g"])("span",F,Object(s["A"])(i.text),1),H]),i.id===e.focusedSubMenu?(Object(s["q"])(),Object(s["f"])("div",z,[Object(s["i"])(a,{sections:i.sections,select:e.selectItem},null,8,["sections","select"])])):Object(s["e"])("",!0)],42,L)):(Object(s["q"])(),Object(s["f"])("li",{key:1,class:Object(s["o"])({disabled:i.disabled}),onClick:t=>e.onItemClick(i)},[Object(s["g"])("a",{class:"item",href:i.disabled?null:i.link,target:"_blank"},[Object(s["G"])(Object(s["g"])("span",$,"✓",512),[[s["C"],i.value]]),Object(s["g"])("span",U,Object(s["A"])(i.text),1),i.shortcut?(Object(s["q"])(),Object(s["f"])("span",N,Object(s["A"])(e.formatShortcut(i.shortcut)),1)):Object(s["e"])("",!0)],8,q)],10,V))],64))),128)),o<e.sections.length-1?(Object(s["q"])(),Object(s["f"])("a",G)):Object(s["e"])("",!0)]))),128))],36)}var Y;(function(e){e[e["OpenSubmenu"]=0]="OpenSubmenu",e[e["RunTask"]=1]="RunTask",e[e["OpenFile"]=2]="OpenFile",e[e["OpenLink"]=3]="OpenLink",e[e["ToggleValue"]=4]="ToggleValue"})(Y||(Y={}));const X={Control:"Ctrl",Escape:"Esc",ArrowLeft:"←",ArrowUp:"↑",ArrowRight:"→",ArrowDown:"↓",Delete:"Del"};var K=Object(s["k"])({name:"ContextMenuListing",setup(){return{file:Object(s["v"])(null)}},props:{sections:{type:Array,required:!0},select:{type:Function,required:!0},forceInsideWindow:{type:Boolean,default:!0}},data(){return{xOffset:0,yOffset:0,leaveTimeout:500,leaveTimeoutId:0,focusedSubMenu:null,selectedFileId:null,MenuAction:Y}},computed:{offset(){return{marginTop:this.yOffset+"px",marginLeft:this.xOffset+"px"}}},methods:{submenuEnter(e){clearTimeout(this.leaveTimeoutId),e.disabled||(this.focusedSubMenu=e.id)},submenuLeave(){this.leaveTimeoutId=setTimeout(()=>{this.focusedSubMenu=null},this.leaveTimeout)},onItemClick(e){if(!e.disabled)switch(e.action){case Y.OpenFile:this.file.click(),this.selectedFileId=e.id,this.select("__preload_"+e.id,!0,e.data);break;case Y.ToggleValue:this.select(e.id,!1,Object.assign(Object.assign({},e.data),{value:e.value}));break;default:this.select(e.id,!0,e.data);break}},readFile(e){let t=e.target.files[0],i=new FileReader;i.onload=e=>{var i;this.select(this.selectedFileId,!0,{filename:t.name,file:null===(i=e.target)||void 0===i?void 0:i.result}),this.selectedFileId=null},i.readAsText(t)},selectItem(e,t,i){this.select(e,t,i),t&&(this.focusedSubMenu=null)},formatShortcut(e){return e?e.split("+").map(e=>e in X?X[e]:e).join("+"):e}},mounted(){if(!this.forceInsideWindow)return;let e=window.innerWidth,t=window.innerHeight,{top:i,left:s,bottom:o,right:n}=this.$el.getBoundingClientRect();this.xOffset=n>e?-Math.min(s,n-e):0,this.yOffset=o>t?-Math.min(i,o-t):0}});i("5dbc");const J=P()(K,[["render",W],["__scopeId","data-v-431fe6dc"]]);var Z=J,Q=Object(s["k"])({name:"TitleBar",props:{menus:{type:Array,default:[]}},data(){return{focusedMenu:null}},emits:["select"],methods:{menuOpen(e){this.focusedMenu=e},menuEnter(e){null!==this.focusedMenu&&(this.focusedMenu=e)},menuClose(){this.focusedMenu=null},menuSelect(e,t,i){this.$emit("select",e,i),t&&(this.focusedMenu=null)}},components:{FocusBox:D,ContextMenuListing:Z}});i("442f");const ee=P()(Q,[["render",T],["__scopeId","data-v-73631bd3"]]);var te=ee,ie=Object(s["k"])({name:"AppTitleBar",computed:Object.assign(Object.assign({},Object(a["c"])("ContextMenuStore",["fileMenu","editMenu","layoutMenu","viewMenu","helpMenu"])),{menus(){return[this.fileMenu,this.editMenu,this.layoutMenu,this.viewMenu,this.helpMenu]}}),methods:Object.assign(Object.assign({},Object(a["b"])("AppActionsStore",["executeAppAction"])),{onItemSelect(e,t){return Object(r["a"])(this,void 0,void 0,(function*(){try{yield this.executeAppAction({id:e,data:t})}catch(i){console.error(i)}}))}}),components:{TitleBar:te}});i("e5f1");const se=P()(ie,[["render",O],["__scopeId","data-v-34dfc6e8"]]);var oe=se;function ne(e,t,i,o,n,r){const a=Object(s["y"])("HotkeyBox");return Object(s["q"])(),Object(s["d"])(a,{class:"app-hotkey-box-element",hotkeys:e.hotkeys,onFire:e.onHotkeyFired},{default:Object(s["F"])(()=>[Object(s["x"])(e.$slots,"default")]),_:3},8,["hotkeys","onFire"])}const re={class:"hotkey-box-container",tabindex:"0"};function ae(e,t,i,o,n,r){return Object(s["q"])(),Object(s["f"])("div",re,[Object(s["x"])(e.$slots,"default",{},void 0,!0)])}class le{constructor(e,t){this._boundAdvanceKeyState=this.advanceKeyState.bind(this),this._boundReverseKeyState=this.reverseKeyState.bind(this),this._callback=e,this._callLoop=void 0,this._container=null,this._hotkeyIdMap=new Map,this._keyState=".",this._recognitionDelay=t,this._selectedFileId=null,this._fileInput=document.createElement("input"),this._fileInput.type="file",this._fileInput.addEventListener("change",this.readFile.bind(this))}observe(e){this._container=e,this._container.addEventListener("keydown",this._boundAdvanceKeyState),this._container.addEventListener("keyup",this._boundReverseKeyState)}disconnect(){var e,t;null===(e=this._container)||void 0===e||e.removeEventListener("keydown",this._boundAdvanceKeyState),null===(t=this._container)||void 0===t||t.removeEventListener("keyup",this._boundReverseKeyState)}setHotkeys(e){this._hotkeyIdMap=new Map;for(let t of e){if(""===t.shortcut)continue;let e=this.keySequenceToHotKeyId(t.shortcut);for(let t of this._hotkeyIdMap.keys())if(t.startsWith(e)||e.startsWith(t))throw new ce(`Overlapping key sequences ('${t}' and '${e}') are not allowed.`);this._hotkeyIdMap.set(e,t)}}setRecognitionDelay(e){this._recognitionDelay=e}isHotkeyActive(e,t=!0){let i=this.keySequenceToHotKeyId(e);return t?this._keyState===i:this._keyState.includes(i)}advanceKeyState(e){let t=e.key.toLocaleLowerCase();if(!this._keyState.endsWith(`.${t}.`)&&(clearTimeout(this._callLoop),this._keyState+=t+".","INPUT"!==e.target.tagName))if(this._hotkeyIdMap.has(this._keyState)){let t=this._hotkeyIdMap.get(this._keyState);t.allowBrowserBehavior||e.preventDefault(),this.triggerHotkey(t)}else e.preventDefault()}reverseKeyState(e){clearTimeout(this._callLoop);let t=e.key.toLocaleLowerCase();this._keyState=this._keyState.replace(`.${t}.`,".")}triggerHotkey(e){e.disabled||(this._callLoop=setTimeout(()=>{switch(e.action){case de.RunTask:this._callback(e.id),e.repeat&&this.runRepeat(e);break;case de.ToggleValue:this._callback(e.id,{value:e.value});break;case de.OpenLink:window.open(e.link,"_blank"),this._keyState=".",this._callback(e.id);break;case de.OpenFile:this._fileInput.click(),this._selectedFileId=e.id,this._callback("__preload_"+e.id);break}},this._recognitionDelay))}runRepeat(e){let t=function(){this._callback(e.id),this._callLoop=setTimeout(t,e.repeat.interval)}.bind(this);this._callLoop=setTimeout(t,e.repeat.delay)}readFile(e){let t=e.target.files[0],i=new FileReader;i.onload=e=>{var i;this._callback(this._selectedFileId,{filename:t.name,file:null===(i=e.target)||void 0===i?void 0:i.result}),this._selectedFileId=null},i.readAsText(t)}keySequenceToHotKeyId(e){let t=e.toLocaleLowerCase().replace(/\s+/g,"").split("+").join(".");return`.${t}.`}}class ce extends Error{constructor(e){super(e)}}var de;(function(e){e[e["RunTask"]=0]="RunTask",e[e["OpenFile"]=1]="OpenFile",e[e["OpenLink"]=2]="OpenLink",e[e["ToggleValue"]=3]="ToggleValue"})(de||(de={}));var he=Object(s["k"])({name:"HotkeyBox",provide(){return{isHotkeyActive:(e,t=!0)=>this.observer.isHotkeyActive(e,t)}},props:{hotkeys:{type:Array,default:[]}},data(){return{observer:Object(s["n"])(new le((e,t)=>this.$emit("fire",e,t),0))}},emits:["fire"],watch:{hotkeys(){this.observer.setHotkeys(this.hotkeys)}},mounted(){this.observer.observe(this.$el),this.observer.setHotkeys(this.hotkeys)}});i("1bb6");const ue=P()(he,[["render",ae],["__scopeId","data-v-54b3aeda"]]);var pe=ue,ge=Object(s["k"])({name:"AppHotkeyBox",computed:Object.assign(Object.assign({},Object(a["c"])("HotkeyStore",["nativeHotkeys","fileHotkeys","editHotKeys","layoutHotkeys","viewHotkeys"])),{hotkeys(){return[...this.nativeHotkeys,...this.fileHotkeys,...this.editHotKeys,...this.layoutHotkeys,...this.viewHotkeys]}}),methods:Object.assign(Object.assign({},Object(a["b"])("AppActionsStore",["executeAppAction"])),{onHotkeyFired(e,t){return Object(r["a"])(this,void 0,void 0,(function*(){try{yield this.executeAppAction({id:e,data:t})}catch(i){console.error(i)}}))}}),components:{HotkeyBox:pe}});const fe=P()(ge,[["render",ne]]);var be=fe;function me(e,t,i,o,n,r){const a=Object(s["y"])("ContextMenu");return Object(s["q"])(),Object(s["f"])("div",{class:"block-diagram-element",style:Object(s["p"])(e.cursorStyle)},[e.menu.show?(Object(s["q"])(),Object(s["d"])(a,{key:0,class:"block-diagram-menu",style:Object(s["p"])(e.menuStyle),sections:e.menuOptions,onSelect:e.onItemSelect,onUnfocus:e.closeContextMenu},null,8,["style","sections","onSelect","onUnfocus"])):Object(s["e"])("",!0)],4)}function _e(e,t,i,o,n,r){const a=Object(s["y"])("ContextMenuListing"),l=Object(s["y"])("FocusBox");return Object(s["q"])(),Object(s["d"])(l,{style:Object(s["p"])(e.offset),class:"context-menu-control",onUnfocus:t[0]||(t[0]=t=>e.$emit("unfocus")),onContextmenu:t[1]||(t[1]=Object(s["H"])(()=>{},["prevent"]))},{default:Object(s["F"])(()=>[Object(s["i"])(a,{sections:e.sections,select:(t,i,s)=>e.$emit("select",t,s),forceInsideWindow:!1},null,8,["sections","select"])]),_:1},8,["style"])}var ve=Object(s["k"])({name:"ContextMenu",props:{sections:{type:Array,required:!0}},data(){return{xOffset:0,yOffset:0}},computed:{offset(){return{marginTop:this.yOffset+"px",marginLeft:this.xOffset+"px"}}},emits:["select","unfocus"],mounted(){let e=window.innerWidth,t=window.innerHeight,{bottom:i,right:s}=this.$el.getBoundingClientRect();this.xOffset=s>e?-(this.$el.clientWidth-1):0,this.yOffset=i>t?-(this.$el.clientHeight-1):0},components:{FocusBox:D,ContextMenuListing:Z}});i("12bf");const ye=P()(ve,[["render",_e],["__scopeId","data-v-6ed3d4b3"]]);var xe=ye,je=Object(s["k"])({name:"BlockDiagram",setup(){return{isHotkeyActive:Object(s["m"])("isHotkeyActive")}},data(){return{cursor:c["d"].Default,diagram:Object(s["n"])(new c["b"]),menu:{x:0,y:0,show:!1}}},computed:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Object(a["d"])("ActivePageStore",{page(e){return e.page.ref},hovers(e){return e.hovers},selects(e){return e.selects.trigger},pageUpdate(e){return e.page.trigger}})),Object(a["c"])("ActivePageStore",["hasSelection"])),Object(a["d"])("AppSettingsStore",{displayGrid(e){return e.settings.view.diagram.display_grid},displayShadows(e){return e.settings.view.diagram.display_shadows},displayDebugMode(e){return e.settings.view.diagram.display_debug_mode},renderHighQuality(e){return e.settings.view.diagram.render_high_quality},disableShadowsAt(e){return e.settings.view.diagram.disable_shadows_at},multiselectHotkey(e){return e.settings.hotkeys.select.many}})),Object(a["c"])("ContextMenuStore",["deleteMenu","clipboardMenu","duplicateMenu","layeringMenu","jumpMenu","createMenu","undoRedoMenu","selectAllMenu","zoomMenu","diagramViewMenu"])),{cursorStyle(){return{cursor:c["e"][this.cursor]}},menuStyle(){return{top:this.menu.y+"px",left:this.menu.x+"px"}},menuOptions(){return this.hasSelection?[this.deleteMenu,this.clipboardMenu,this.duplicateMenu,this.layeringMenu,this.jumpMenu]:[this.undoRedoMenu,this.createMenu,this.selectAllMenu,this.zoomMenu,this.diagramViewMenu]}}),methods:Object.assign(Object.assign(Object.assign({},Object(a["b"])("ActivePageStore",["select","unselectAll","attach","detach","hover","unhoverAll","moveBy","addLineObject","moveCameraTo","setViewTransform"])),Object(a["b"])("AppActionsStore",["executeAppAction"])),{onItemSelect(e,t){try{"create_object"===e?this.executeAppAction({id:e,data:Object.assign(Object.assign({},t),{x:this.menu.x,y:this.menu.y})}):this.executeAppAction({id:e,data:t})}catch(i){console.error(i)}this.closeContextMenu()},openContextMenu(e,t){requestAnimationFrame(()=>{this.menu.show=!0,this.menu.x=e,this.menu.y=t})},closeContextMenu(){this.menu.show=!1}}),watch:{page(){this.diagram.setPage(Object(s["n"])(this.page)),this.diagram.updateView(0)},hovers(){this.diagram.render()},selects(){this.diagram.render()},pageUpdate(){this.diagram.updateView()},displayGrid(){this.diagram.setGridDisplay(this.displayGrid),this.diagram.render()},displayShadows(){this.diagram.setShadowsDisplay(this.displayShadows),this.diagram.render()},displayDebugMode(){this.diagram.setDebugDisplay(this.displayDebugMode),this.diagram.render()},renderHighQuality(){this.diagram.setSsaaScale(this.renderHighQuality?2:1),this.diagram.render()},disableShadowsAt(){this.diagram.setShadowsDisableAt(this.disableShadowsAt),this.diagram.render()}},mounted(){this.diagram.on("object-hover",(e,t)=>{this.cursor=t,e?this.hover(e.id):this.unhoverAll()}),this.diagram.on("object-click",(e,t,i,s)=>{this.isHotkeyActive(this.multiselectHotkey)||t.isSelected()||this.unselectAll(),this.select(t.id),e.button===c["j"].Right&&this.openContextMenu(i,s)}),this.diagram.on("canvas-click",(e,t,i)=>{this.unselectAll(),e.button===c["j"].Right&&this.openContextMenu(t,i)}),this.diagram.on("canvas-transform",(e,t,i)=>{this.setViewTransform({x:e,y:t,k:i})}),this.diagram.on("object-move",(e,t,i)=>{this.moveBy({objects:e.map(e=>e.id),dx:t,dy:i})}),this.diagram.on("object-attach",(e,t)=>{this.attach({object:e.id,anchor:t.id})}),this.diagram.on("object-detach",(e,t,i)=>{this.detach({object:e.id,dx:t,dy:i})}),this.diagram.on("line-create",(e,t,i,s)=>{this.addLineObject({object:e,source:i.id,target:null===s||void 0===s?void 0:s.id,parent:t.id}),this.unselectAll(),this.select(e.id)}),this.diagram.on("camera-move",e=>{this.moveCameraTo(e)}),this.diagram.setGridDisplay(this.displayGrid),this.diagram.setShadowsDisplay(this.displayShadows),this.diagram.setDebugDisplay(this.displayDebugMode),this.diagram.setSsaaScale(this.renderHighQuality?2:1),this.diagram.setShadowsDisableAt(this.disableShadowsAt),this.diagram.setPage(Object(s["n"])(this.page)),this.diagram.inject(this.$el)},unmounted(){this.diagram.destroy()},components:{ContextMenu:xe}});i("4ebf");const we=P()(je,[["render",me],["__scopeId","data-v-40949232"]]);var ke=we;const Oe=e=>(Object(s["t"])("data-v-0ec2c908"),e=e(),Object(s["r"])(),e),Se={class:"app-footer-bar-element"},Me={class:"info left"},Te={class:"selected"},Ae=Oe(()=>Object(s["g"])("span",null,"Selected:",-1)),Ce={class:"info right"},Be={key:0,class:"page-check valid"},Pe=Oe(()=>Object(s["g"])("span",null,"✓",-1)),Re={key:1,class:"page-check invalid"},De=Oe(()=>Object(s["g"])("span",null,"⚠",-1));function Ee(e,t,i,o,n,r){return Object(s["q"])(),Object(s["f"])("div",Se,[Object(s["g"])("div",Me,[Object(s["g"])("p",Te,[Ae,Object(s["h"])(" "+Object(s["A"])(e.selects),1)])]),Object(s["g"])("div",Ce,[e.isPageValid?(Object(s["q"])(),Object(s["f"])("div",Be,[Pe,Object(s["h"])(" Valid "+Object(s["A"])(e.fileName),1)])):(Object(s["q"])(),Object(s["f"])("div",Re,[De,Object(s["h"])(" Invalid "+Object(s["A"])(e.fileName),1)]))])])}var Le=Object(s["k"])({name:"AppFooterBar",data(){return{fileName:j.file_type_name}},computed:Object.assign(Object.assign({},Object(a["d"])("ActivePageStore",{selects(e){return 1+e.selects.trigger===0?0:e.selects.ref.size}})),Object(a["c"])("ActivePageStore",["isPageValid"]))});i("c4f4");const Ie=P()(Le,[["render",Ee],["__scopeId","data-v-0ec2c908"]]);var Fe=Ie;function He(e,t,i,o,n,r){const a=Object(s["y"])("ObjectEditor"),l=Object(s["y"])("Tab"),c=Object(s["y"])("TabBox");return Object(s["q"])(),Object(s["d"])(c,{class:"editor-tabs-element",modelValue:e.active,"onUpdate:modelValue":t[0]||(t[0]=t=>e.active=t)},{default:Object(s["F"])(()=>[Object(s["i"])(l,{class:"object-properties",name:"Properties"},{default:Object(s["F"])(()=>[Object(s["i"])(a)]),_:1})]),_:1},8,["modelValue"])}const ze={key:0,class:"tab-container"};function Ve(e,t,i,o,n,r){return e.isActive?(Object(s["q"])(),Object(s["f"])("div",ze,[Object(s["x"])(e.$slots,"default",{},void 0,!0)])):Object(s["e"])("",!0)}var qe=Object(s["k"])({name:"Tab",setup(){let e=Object(s["l"])(),t=Object(s["m"])("tabsState");if(void 0===t)throw new TypeError("<Tab> can only be used within a <TabBox>.");let{active:i,tabs:o}=t,n=Object(s["b"])(()=>o.value.findIndex(t=>t.props.name===e.props.name)),r=Object(s["b"])(()=>n.value===i.value);return Object(s["E"])(()=>{-1===n.value&&o.value.push(e)}),{isActive:r}},props:{name:{type:String,required:!0}}});i("61f7");const $e=P()(qe,[["render",Ve],["__scopeId","data-v-450513ef"]]);var Ue=$e;const Ne={class:"tab-box-container"},Ge={class:"tab-box-header"},We=["onClick"],Ye={class:"tab-box-body"};function Xe(e,t,i,o,n,r){return Object(s["q"])(),Object(s["f"])("div",Ne,[Object(s["g"])("div",Ge,[(Object(s["q"])(!0),Object(s["f"])(s["a"],null,Object(s["w"])(e.tabs,(t,i)=>(Object(s["q"])(),Object(s["f"])("li",{key:i,class:Object(s["o"])(["tab-link",{active:e.active===i}]),onClick:t=>e.select(i)},[Object(s["g"])("p",null,Object(s["A"])(t.props.name),1)],10,We))),128)),e.canClose?(Object(s["q"])(),Object(s["f"])("li",{key:0,class:"close-link",onClick:t[0]||(t[0]=t=>e.$emit("close"))},"✗")):Object(s["e"])("",!0)]),Object(s["g"])("div",Ye,[Object(s["x"])(e.$slots,"default",{},void 0,!0)])])}var Ke=Object(s["k"])({name:"TabBox",setup(e,{emit:t}){let i=Object(s["b"])(()=>e.modelValue),o=Object(s["v"])([]);function n(e){t("update:modelValue",e)}return Object(s["s"])("tabsState",{active:i,tabs:o}),{active:i,tabs:o,select:n}},props:{canClose:{type:Boolean,default:!0},modelValue:{type:[String,Number]}},emits:["update:modelValue","close"]});i("281e");const Je=P()(Ke,[["render",Xe],["__scopeId","data-v-2649b21e"]]);var Ze=Je;const Qe={class:"object-editor-element"},et=Object(s["h"])(" Nothing ");function tt(e,t,i,o,n,r){const a=Object(s["y"])("DictionaryFieldContents"),l=Object(s["y"])("ScrollBox");return Object(s["q"])(),Object(s["f"])("div",Qe,[e.selected?(Object(s["q"])(),Object(s["d"])(l,{key:0,class:"scrollbox",alwaysShowScrollBar:!0,scrollColor:"#1f1f1f"},{default:Object(s["F"])(()=>[Object(s["i"])(a,{class:"contents",property:e.property,onChange:e.onChange},null,8,["property","onChange"])]),_:1})):(Object(s["q"])(),Object(s["f"])(s["a"],{key:1},[et],64))])}const it={class:"scrollbox-container"};function st(e,t,i,o,n,r){return Object(s["q"])(),Object(s["f"])("div",it,[Object(s["g"])("div",{ref:"content",class:"scroll-content",onWheelPassive:t[0]||(t[0]=t=>e.moveScrollPosition(e.scrollTop+t.deltaY,t))},[Object(s["x"])(e.$slots,"default",{},void 0,!0)],544),Object(s["G"])(Object(s["g"])("div",{class:"scroll-bar",style:Object(s["p"])(e.scroll.sty),onWheelPassive:t[3]||(t[3]=t=>e.moveScrollPosition(e.scrollTop+t.deltaY,t))},[Object(s["G"])(Object(s["g"])("div",{class:"scroll-handle",style:Object(s["p"])(e.handle.sty),onPointerdown:t[1]||(t[1]=(...t)=>e.startDrag&&e.startDrag(...t)),onPointerup:t[2]||(t[2]=(...t)=>e.stopDrag&&e.stopDrag(...t))},null,36),[[s["C"],e.showScrollbar]])],36),[[s["C"],e.alwaysShowScrollBar||e.showScrollbar]])])}class ot{constructor(){this.deltaX=0,this.deltaY=0,this.movementX=0,this.movementY=0,this.target=null,this._originX=0,this._originY=0,this._lastX=0,this._lastY=0}capture(e,t){this._originX=e.clientX,this._originY=e.clientY,this._lastX=this._originX,this._lastY=this._originY,this.target=e.target,this.target.setPointerCapture(e.pointerId),this.target.onpointermove=e=>{this.update(e),t(e,this)}}update(e){this.deltaX=e.clientX-this._originX,this.deltaY=e.clientY-this._originY,this.movementX=e.clientX-this._lastX,this.movementY=e.clientY-this._lastY,this._lastX=e.clientX,this._lastY=e.clientY}release(e){null!==this.target&&(this.target.releasePointerCapture(e.pointerId),this.target.onpointermove=null,this.target=null)}}var nt=Object(s["k"])({name:"ScrollBox",setup(){return{content:Object(s["v"])(null)}},props:{resetScrollOnChange:{type:Boolean,default:!1},alwaysShowScrollBar:{type:Boolean,default:!1},handleColor:{type:String,default:"#333333"},scrollColor:{type:String,default:"none"},borderColor:{type:String,default:"#404040"},width:{type:Number,default:17}},data(){return{scrollTop:0,windowMax:0,scroll:{sty:{width:this.width+"px",background:this.scrollColor}},handle:{trk:Object(s["n"])(new ot),hei:0,max:0,pos:0,sty:{height:"0px",transform:"translateY(0px)",background:this.handleColor,borderColor:this.borderColor}},showScrollbar:!1,onResizeObserver:null,onMutateObserver:null}},methods:{startDrag(e){this.handle.trk.capture(e,this.onDrag),document.addEventListener("pointerup",this.stopDrag,{once:!0})},onDrag(e,t){this.moveScrollPosition(this.handleTopToTop(this.handle.pos+t.movementY))},stopDrag(e){this.handle.trk.release(e)},recalculateScrollState(e=!0){let t=this.showScrollbar,i=this.content;if(0===i.clientHeight)return void(this.showScrollbar=!1);let s=i.clientHeight/i.scrollHeight;this.handle.hei=Math.max(15,Math.round((i.clientHeight-4)*s)),this.handle.max=i.clientHeight-this.handle.hei-4,this.windowMax=i.scrollHeight-i.clientHeight,this.showScrollbar=1!==s,this.handle.sty.height=this.handle.hei+"px",this.moveScrollPosition(e?0:i.scrollTop),!t&&this.showScrollbar&&setTimeout(()=>this.recalculateScrollState(e),0)},moveScrollPosition(e,t=null){let i=this.scrollTop;this.scrollTop=Object(c["r"])(e,0,this.windowMax),this.handle.pos=this.topToHandleTop(this.scrollTop),this.handle.sty.transform=`translateY(${this.handle.pos}px)`,this.content.scrollTop=this.scrollTop;let s=i-this.scrollTop!==0;(s||0<this.scrollTop&&this.scrollTop<this.windowMax)&&(null===t||void 0===t||t.stopPropagation())},topToHandleTop(e){return e/this.windowMax*this.handle.max},handleTopToTop(e){return e/this.handle.max*this.windowMax}},mounted(){let e={childList:!0,characterData:!0,subtree:!0};this.onMutateObserver=new MutationObserver(()=>this.recalculateScrollState(this.resetScrollOnChange)),this.onResizeObserver=new ResizeObserver(()=>this.recalculateScrollState(!1)),this.onResizeObserver.observe(this.$el),this.onMutateObserver.observe(this.content,e)},unmounted(){this.onResizeObserver.disconnect(),this.onMutateObserver.disconnect()}});i("1a8c");const rt=P()(nt,[["render",st],["__scopeId","data-v-8005e880"]]);var at=rt,lt=i("69ee"),ct=Object(s["k"])({name:"ObjectEditor",computed:Object.assign(Object.assign({},Object(a["d"])("ActivePageStore",{selects(e){return e.selects.ref},selectTrigger(e){return e.selects.trigger},pageUpdate(e){return e.page.trigger}})),{selected(){if(1+this.selectTrigger!==0&&1===this.selects.size){let e=this.selects.values().next().value;if(e instanceof c["f"])return e}},property(){var e;if(1+this.pageUpdate!==0)return null===(e=this.selected)||void 0===e?void 0:e.props}}),methods:Object.assign(Object.assign(Object.assign({},Object(a["b"])("AppActionsStore",["executeAppAction"])),Object(a["b"])("ActivePageStore",["setObjectProperty"])),{onChange(e,t){this.setObjectProperty({object:this.selected.id,property:e,value:t})}}),components:{ScrollBox:at,DictionaryFieldContents:lt["a"]}});i("de5a");const dt=P()(ct,[["render",tt],["__scopeId","data-v-2fefc0d5"]]);var ht=dt,ut=Object(s["k"])({name:"EditorTabs",setup(){return{active:Object(s["v"])(0)}},computed:Object.assign(Object.assign({},Object(a["c"])("ContextMenuStore",["fileMenu","editMenu","layoutMenu","viewMenu","helpMenu"])),{menus(){return[this.fileMenu,this.editMenu,this.layoutMenu,this.viewMenu,this.helpMenu]}}),methods:Object.assign(Object.assign({},Object(a["b"])("AppActionsStore",["executeAppAction"])),{onItemSelect(e,t){return Object(r["a"])(this,void 0,void 0,(function*(){try{yield this.executeAppAction({id:e,data:t})}catch(i){console.error(i)}}))}}),components:{TabBox:Ze,Tab:Ue,ObjectEditor:ht}});i("689d");const pt=P()(ut,[["render",He],["__scopeId","data-v-3fa6d5c0"]]);var gt=pt,ft=Object(s["k"])({name:"App",methods:Object.assign(Object.assign({},Object(a["b"])("ActiveDocumentStore",["createEmptyDocument","openDocument"])),Object(a["b"])("AppSettingsStore",["loadSettings"])),created(){return Object(r["a"])(this,void 0,void 0,(function*(){yield this.loadSettings(),yield this.createEmptyDocument("Untitled "+j.file_type_name)}))},components:{AppHotkeyBox:be,AppTitleBar:oe,BlockDiagram:ke,AppFooterBar:Fe,EditorTabs:gt}});i("1aaf");const bt=P()(ft,[["render",n]]);var mt=bt,_t={namespaced:!0,state:{page:{trigger:0,editor:Object(s["n"])(new c["k"](c["m"].createDummy())),ref:c["m"].createDummy()},hovers:[],selects:{trigger:0,ref:Object(s["n"])(new Map)},transform:{x:0,y:0,k:1},validator:void 0},getters:{hasSelection(e){return 1+e.selects.trigger!==0&&0<e.selects.ref.size},canUndo(e){return 1+e.page.trigger!==0&&e.page.editor.canUndo()},canRedo(e){return 1+e.page.trigger!==0&&e.page.editor.canRedo()},isPageValid(e){var t,i;return null===(i=null===(t=e.validator)||void 0===t?void 0:t.inValidState())||void 0===i||i}},actions:{select({commit:e},t){if(Array.isArray(t))for(let i of t)e("addToSelection",i);else e("addToSelection",t)},selectAll({dispatch:e,state:t}){let i=t.page.ref.children;e("unselectAll"),e("select",i.map(e=>e.id))},unselectAll({commit:e,state:t}){let i=t.selects;if(0!==i.ref.size)for(let s of i.ref.keys())e("removeFromSelection",s)},updateSelect({commit:e,state:t}){for(let i of t.selects.ref.keys())t.page.ref.lookup(i)||e("removeFromSelection",i)},pivotSelectGraphParents({dispatch:e}){let t=c["p"].getPrevGraphLinks.bind(c["p"]);e("__pivotSelectGraph",t)},pivotSelectGraphChildren({commit:e,dispatch:t,state:i}){let s=c["p"].getNextGraphLinks.bind(c["p"]);t("__pivotSelectGraph",s)},__pivotSelectGraph({commit:e,dispatch:t,state:i},s){let o=[...i.selects.ref.values()];t("unselectAll");for(let n of o){let t=s(n);if(n.hasRole(c["q"].Node))for(let i of t){let t=s(i);if(t.length)for(let i of t)e("addToSelection",i.id);else e("addToSelection",i.id)}else for(let i of t)e("addToSelection",i.id)}},hover({commit:e},t){e("clearHover"),e("setHover",t)},unhoverAll({commit:e}){e("clearHover")},updateHover({commit:e,state:t}){let i=t.hovers;i.length&&!t.page.ref.lookup(i[0].id)&&e("clearHover")},spawnObject({commit:e,state:t},{template:i,parent:s,x:o,y:n}){let r=t.page.ref.factory.createObject(i),a=t.transform;if(void 0===o)o=a.x+(t.page.ref.location.x-a.x);else{let{xMid:e,xMin:t}=r.boundingBox;o=(o-a.x)/a.k+e-t}if(void 0===n)n=a.y+(t.page.ref.location.y-a.y);else{let{yMid:e,yMin:t}=r.boundingBox;n=(n-a.y)/a.k+e-t}r.getAlignment()===c["a"].Grid&&(o=Object(c["s"])(o,t.page.ref.grid[0]),n=Object(c["s"])(n,t.page.ref.grid[1])),r.moveTo(o,n),e("addObjects",{objects:r,parent:s})},addObjects({commit:e},t){e("addObjects",t)},addLineObject({commit:e},t){e("addLineObject",t)},removeObject({commit:e,dispatch:t},i){e("removeObject",i),t("updateSelect"),t("updateHover")},removeSelected({commit:e,dispatch:t}){e("removeSelected"),t("updateSelect"),t("updateHover")},duplicateSelected({commit:e,dispatch:t,state:i,rootState:s}){let o=i.selects.ref,n=i.page.ref.factory,r=s.AppSettingsStore.settings.edit.clone_offset;if(!o.size)return;let a=n.cloneObjects(...o.values()),[l,c]=i.page.ref.grid;for(let d of a)d.moveBy(r[0]*l,r[1]*c);e("addObjects",{objects:a}),t("unselectAll"),t("select",a.map(e=>e.id))},attach({commit:e},t){e("attach",t)},detach({commit:e},t){e("detach",t)},moveBy({commit:e},t){e("moveObjectsBy",t)},setObjectProperty({commit:e},t){e("setObjectProperty",t)},reorderSelected({commit:e,state:t},i){let s=t.selects.ref;s.size&&e("reorderObjects",{objects:[...s.keys()].reverse(),layer:i})},moveCameraTo({commit:e},t){e("setCameraLocation",t)},resetView({commit:e}){e("setCameraLocation",{type:c["i"].Point,x:0,y:0,k:1})},zoomIn({commit:e,state:t}){let i,s=t.page.ref.location;switch(s.type){case c["i"].Region:i=t.transform.k+.25;break;case c["i"].Point:i=s.k+.25;break}e("setCameraLocation",{type:c["i"].Point,x:s.x,y:s.y,k:i})},zoomOut({commit:e,state:t}){let i,s=t.page.ref.location;switch(s.type){case c["i"].Region:i=t.transform.k-.25;break;case c["i"].Point:i=s.k-.25;break}e("setCameraLocation",{type:c["i"].Point,x:s.x,y:s.y,k:i})},moveCameraToSelection({commit:e,state:t}){if(0===t.selects.ref.size)return;let i=1/0,s=1/0,o=-1/0,n=-1/0;for(let c of t.selects.ref.values())i=Math.min(i,c.boundingBox.xMin),s=Math.min(s,c.boundingBox.yMin),o=Math.max(o,c.boundingBox.xMax),n=Math.max(n,c.boundingBox.yMax);let r=o-i,a=n-s,l=Math.round((i+o)/2),d=Math.round((s+n)/2);e("setCameraLocation",{type:c["i"].Region,x:l,y:d,w:r,h:a})},setViewTransform({commit:e},t){e("setViewTransform",t)},undo({commit:e,dispatch:t}){e("undo"),t("updateSelect"),t("updateHover")},redo({commit:e,dispatch:t}){e("redo"),t("updateSelect"),t("updateHover")},snapImage({commit:e,state:t,rootState:i},s){e("toggleHover",!1),e("toggleSelect",!1);let o,{diagram:n}=i.AppSettingsStore.settings.view,{image_export:r}=i.AppSettingsStore.settings.file,a=new c["l"](t.page.ref,r.padding,n.display_grid,n.display_shadows,n.display_debug_mode);return o=s.length?a.capture(s):a.capture(),e("toggleSelect",!0),e("toggleHover",!0),o}},mutations:{setActivePage(e,t){for(let i of e.selects.ref.values())i.setSelect(c["o"].Unselected);e.selects.ref=Object(s["n"])(new Map);for(let i of e.hovers)i.setHover(c["g"].Off);e.hovers=[],e.page.editor=Object(s["n"])(t),e.page.ref=Object(s["n"])(t.page),j.validator&&(e.validator=new j.validator,e.validator.reset())},addToSelection(e,t){let i=e.selects.ref,s=e.page.ref.lookup(t);if(!s)throw new Error(`'${t}' does not exist.`);if(!i.has(t)){if(0===i.size)s.setSelect(c["o"].Single);else if(1===i.size){let e=i.values().next().value;e.setSelect(c["o"].Multi),s.setSelect(c["o"].Multi)}else s.setSelect(c["o"].Multi);i.set(s.id,s),e.selects.trigger++}},removeFromSelection(e,t){let i=e.selects.ref;if(!i.has(t))return;let s=i.get(t);if(s.setSelect(c["o"].Unselected),i.delete(t),1===i.size){let e=i.values().next().value;e.setSelect(c["o"].Single)}e.selects.trigger++},toggleSelect(e,t){let i=e.selects.ref;if(t)if(1===i.size){let e=i.values().next().value;e.setSelect(c["o"].Single)}else for(let s of i.values())s.setSelect(c["o"].Multi);else for(let s of i.values())s.setSelect(c["o"].Unselected)},setHover(e,t){let i=e.page.ref.lookup(t);if(!i)throw new Error(`'${t}' does not exist.`);let s=[i];i.setHover(c["g"].Direct);let o=i.parent;while(o)s.push(o),o.setHover(c["g"].Indirect),o=o.parent;e.hovers=s},clearHover(e){let t=e.hovers;for(let i=0;i<t.length;i++)t[i].setHover(c["g"].Off);e.hovers=[]},toggleHover(e,t){let i=e.hovers;if(t&&i.length){i[0].setHover(c["g"].Direct);for(let e=1;e<i.length;e++)i[e].setHover(c["g"].Indirect)}else for(let s of i)s.setHover(c["g"].Off)},addObjects(e,{objects:t,parent:i}){var s;if(Array.isArray(t)){e.page.editor.beginTransaction();for(let s of t)e.page.editor.addObject(s,i);e.page.editor.endTransaction()}else e.page.editor.addObject(t,i);null===(s=e.validator)||void 0===s||s.run(e.page.ref),e.page.trigger++},addLineObject(e,{object:t,source:i,target:s,parent:o}){var n;e.page.editor.addLineObject(t,i,s,o),null===(n=e.validator)||void 0===n||n.run(e.page.ref),e.page.trigger++},removeObject(e,t){var i;e.page.editor.removeObjects(t),null===(i=e.validator)||void 0===i||i.run(e.page.ref),e.page.trigger++},removeSelected(e){var t;let i=e.selects.ref;i.size&&(e.page.editor.removeObjects(...i.keys()),null===(t=e.validator)||void 0===t||t.run(e.page.ref),e.page.trigger++)},attach(e,{object:t,anchor:i}){var s;e.page.editor.attach(t,i),null===(s=e.validator)||void 0===s||s.run(e.page.ref),e.page.trigger++},detach(e,{object:t,dx:i,dy:s}){var o;i=null!==i&&void 0!==i?i:0,s=null!==s&&void 0!==s?s:0,i||s?(e.page.editor.beginTransaction(),e.page.editor.moveObjectsBy(t,i,s),e.page.editor.detach(t),e.page.editor.endTransaction()):e.page.editor.detach(t),null===(o=e.validator)||void 0===o||o.run(e.page.ref),e.page.trigger++},moveObjectsBy(e,{objects:t,dx:i,dy:s}){i=Math.round(i),s=Math.round(s),e.page.editor.moveObjectsBy(t,i,s),e.page.trigger++},setObjectProperty(e,{object:t,property:i,value:s}){let o=e.page.ref.lookup(t);if(!o)throw new Error(`No object with id: '${t}'.`);o.setProperty(i,s),e.page.trigger++},reorderObjects(e,{objects:t,layer:i}){if(Array.isArray(t)){e.page.editor.beginTransaction();for(let s of t)e.page.editor.reorderObjectLayer(s,i);e.page.editor.endTransaction()}else e.page.editor.reorderObjectLayer(t,i);e.page.trigger++},setCameraLocation(e,t){e.page.editor.setCameraLocation(t),e.page.trigger++},setViewTransform(e,t){e.transform=t},undo(e){var t;e.page.editor.undo(),null===(t=e.validator)||void 0===t||t.run(e.page.ref),e.page.trigger++},redo(e){var t;e.page.editor.redo(),null===(t=e.validator)||void 0===t||t.run(e.page.ref),e.page.trigger++}}};class vt{static textFile(e,t,i="txt"){let s=new Blob([t],{type:"octet/stream"}),o=window.URL.createObjectURL(s);this._aLink.href=o,this._aLink.download=`${e}.${i}`,this._aLink.click(),window.URL.revokeObjectURL(o)}static imageFile(e,t){t.toBlob(t=>{if(!t)return;let i=window.URL.createObjectURL(t);this._aLink.href=i,this._aLink.download=e+".png",this._aLink.click(),window.URL.revokeObjectURL(i)},"image/octet-stream")}}vt._aLink=document.createElement("a");const yt={root:!0};var xt={namespaced:!0,state:{document:Object(s["n"])(c["c"].createDummy()),clipboard:[],publisher:void 0},getters:{hasClipboardContents(e){return 0<e.clipboard.length}},actions:{createEmptyDocument(e,t){return Object(r["a"])(this,void 0,void 0,(function*(){let{commit:i,state:s}=e,o=structuredClone(j.schema);i("setActiveDocument",yield c["c"].create(t,o)),i("ActivePageStore/setActivePage",s.document.editor,yt)}))},openDocument(e,t){return Object(r["a"])(this,void 0,void 0,(function*(){let{commit:i,state:s}=e;i("setActiveDocument",yield c["c"].deserialize(t)),i("ActivePageStore/setActivePage",s.document.editor,yt)}))},saveDocumentToDevice({state:e}){let t=JSON.stringify(e.document.toExport());vt.textFile(e.document.name,t,j.file_type_extension)},saveActivePageImageToDevice({dispatch:e,state:t}){return Object(r["a"])(this,void 0,void 0,(function*(){let i=yield e("ActivePageStore/snapImage",[],yt);vt.imageFile(t.document.name,i)}))},saveActiveSelectionImageToDevice({dispatch:e,state:t,rootState:i}){return Object(r["a"])(this,void 0,void 0,(function*(){let s=i.ActivePageStore.selects.ref;if(!s.size)return;let o=yield e("ActivePageStore/snapImage",[...s.keys()],yt);vt.imageFile(t.document.name,o)}))},publishActivePageToDevice({dispatch:e,state:t,rootState:i,rootGetters:s}){return Object(r["a"])(this,void 0,void 0,(function*(){let e=i.ActivePageStore.page.ref;if(!t.publisher)return;if(!s["ActivePageStore/isPageValid"])return;let o=t.publisher.publish(e);vt.textFile(t.document.name,o,"json")}))},clipboardCut({commit:e,dispatch:t,state:i,rootState:s}){let o=i.document.factory,n=s.ActivePageStore.selects.ref;n.size&&(e("setClipboard",o.cloneObjects(...n.values())),t("ActivePageStore/removeSelected",null,yt))},clipboardCopy({commit:e,state:t,rootState:i}){let s=t.document.factory,o=i.ActivePageStore.selects.ref,n=i.AppSettingsStore.settings.edit.clone_offset;if(!o.size)return;e("setClipboard",s.cloneObjects(...o.values()));let[r,a]=i.ActivePageStore.page.ref.grid;e("offsetClipboard",{dx:n[0]*r,dy:n[1]*a})},clipboardPaste({commit:e,dispatch:t,state:i,rootState:s}){let o=i.document.factory,n=s.AppSettingsStore.settings.edit.clone_offset,r=o.cloneObjects(...i.clipboard);t("ActivePageStore/addObjects",{objects:r},yt),t("ActivePageStore/unselectAll",null,yt),t("ActivePageStore/select",r.map(e=>e.id),yt);let[a,l]=s.ActivePageStore.page.ref.grid;e("offsetClipboard",{dx:n[0]*a,dy:n[1]*l})}},mutations:{setActiveDocument(e,t){e.document=Object(s["n"])(t),j.publisher&&(e.publisher=new j.publisher)},setClipboard(e,t){e.clipboard=t},offsetClipboard(e,{dx:t,dy:i}){for(let s of e.clipboard)s.moveBy(t,i)}}};function jt(e=document.body){let t=e;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}const wt={root:!0};var kt={namespaced:!0,actions:{executeAppAction({dispatch:e,rootState:t},{id:i,data:s}){return Object(r["a"])(this,void 0,void 0,(function*(){switch(i){case"new_file":yield e("ActiveDocumentStore/createEmptyDocument","Untitled "+j.file_type_name,wt);break;case"open_file":yield e("ActiveDocumentStore/openDocument",s.file,wt);break;case"save_file":yield e("ActiveDocumentStore/saveDocumentToDevice",null,wt);break;case"save_image":yield e("ActiveDocumentStore/saveActivePageImageToDevice",null,wt);break;case"save_select_image":yield e("ActiveDocumentStore/saveActiveSelectionImageToDevice",null,wt);break;case"publish_file":yield e("ActiveDocumentStore/publishActivePageToDevice",null,wt);break;case"open_library":break;case"save_library":break;case"undo":yield e("ActivePageStore/undo",null,wt);break;case"redo":yield e("ActivePageStore/redo",null,wt);break;case"cut":yield e("ActiveDocumentStore/clipboardCut",null,wt);break;case"copy":yield e("ActiveDocumentStore/clipboardCopy",null,wt);break;case"paste":yield e("ActiveDocumentStore/clipboardPaste",null,wt);break;case"create_object":yield e("ActivePageStore/spawnObject",{template:s.template,parent:s.parent,x:s.x,y:s.y},wt);break;case"delete":yield e("ActivePageStore/removeSelected",null,wt);break;case"duplicate":yield e("ActivePageStore/duplicateSelected",null,wt);break;case"select_all":yield e("ActivePageStore/selectAll",null,wt);break;case"selection_to_front":yield e("ActivePageStore/reorderSelected",c["h"].Top,wt);break;case"selection_to_back":yield e("ActivePageStore/reorderSelected",c["h"].Bottom,wt);break;case"bring_selection_forward":yield e("ActivePageStore/reorderSelected",c["h"].OneAbove,wt);break;case"send_selection_backward":yield e("ActivePageStore/reorderSelected",c["h"].OneBelow,wt);break;case"align_left":break;case"align_center":break;case"align_right":break;case"align_top":break;case"align_middle":break;case"align_bottom":break;case"group":break;case"ungroup":break;case"open_group":break;case"close_group":break;case"toggle_grid":yield e("AppSettingsStore/setGridDisplay",!s.value,wt);break;case"toggle_shadows":yield e("AppSettingsStore/setShadowsDisplay",!s.value,wt);break;case"enable_high_quality_render":yield e("AppSettingsStore/setHighRenderQuality",!0,wt);break;case"enable_low_quality_render":yield e("AppSettingsStore/setHighRenderQuality",!1,wt);break;case"reset_view":yield e("ActivePageStore/resetView",null,wt);break;case"zoom_in":yield e("ActivePageStore/zoomIn",null,wt);break;case"zoom_out":yield e("ActivePageStore/zoomOut",null,wt);break;case"jump_to_selection":yield e("ActivePageStore/moveCameraToSelection",null,wt);break;case"jump_to_parents":yield e("ActivePageStore/pivotSelectGraphParents",null,wt),yield e("ActivePageStore/moveCameraToSelection",null,wt);break;case"jump_to_children":yield e("ActivePageStore/pivotSelectGraphChildren",null,wt),yield e("ActivePageStore/moveCameraToSelection",null,wt);break;case"fullscreen":jt();break;case"toggle_debug_view":yield e("AppSettingsStore/setDebugDisplay",!s.value,wt);break;case"open_about_window":break;default:break}}))}}},Ot=i("14d9"),St={namespaced:!0,state:{settings:{file:{image_export:{padding:0}},edit:{clone_offset:[0,0]},view:{diagram:{display_grid:!0,display_shadows:!0,display_debug_mode:!1,render_high_quality:!0,disable_shadows_at:0}},hotkeys:{file:{new_file:"",open_file:"",save_file:"",save_image:"",save_select_image:"",publish_file:"",open_library:"",save_library:""},edit:{undo:"",redo:"",cut:"",copy:"",paste:"",delete:"",duplicate:"",select_all:""},layout:{selection_to_front:"",selection_to_back:"",bring_selection_forward:"",send_selection_backward:"",align_left:"",align_center:"",align_right:"",align_top:"",align_middle:"",align_bottom:"",group:"",ungroup:"",open_group:"",close_group:""},view:{toggle_grid:"",toggle_shadows:"",reset_view:"",zoom_in:"",zoom_out:"",fullscreen:"",jump_to_selection:"",jump_to_parents:"",jump_to_children:"",toggle_debug_view:""},select:{many:""}}}},actions:{loadSettings({commit:e}){return Object(r["a"])(this,void 0,void 0,(function*(){let t=Ot;e("loadSettings",t)}))},setGridDisplay({commit:e},t){e("setDiagramSetting",{key:"display_grid",value:t})},setShadowsDisplay({commit:e},t){e("setDiagramSetting",{key:"display_shadows",value:t})},setHighRenderQuality({commit:e},t){e("setDiagramSetting",{key:"render_high_quality",value:t})},setDebugDisplay({commit:e},t){e("setDiagramSetting",{key:"display_debug_mode",value:t})}},mutations:{loadSettings(e,t){e.settings=t},setDiagramSetting(e,{key:t,value:i}){e.settings.view.diagram[t]=i}}},Mt={namespaced:!0,getters:{fileMenu(e,t,i,s){let{file:o}=i.AppSettingsStore.settings.hotkeys,n=j.file_type_name,r=s["ActivePageStore/isPageValid"],a=s["ActivePageStore/hasSelection"];return Tt({id:"file_menu",text:"File",action:Y.OpenSubmenu,sections:[{id:"open_file_options",items:[{id:"new_file",text:"New File",action:Y.RunTask,shortcut:o.new_file},{id:"open_file",text:"Open File...",action:Y.OpenFile,shortcut:o.open_file}]},{id:"save_file_options",items:[{id:"save_file",text:"Save",action:Y.RunTask,shortcut:o.save_file},{id:"save_image",text:"Save as Image",action:Y.RunTask,shortcut:o.save_image},{id:"save_select_image",text:"Save Selection as Image",action:Y.RunTask,shortcut:o.save_select_image,disabled:!a}]},{id:"publish_options",items:[{id:"publish_file",text:"Publish "+n,action:Y.RunTask,shortcut:o.publish_file,disabled:!r}]},{id:"library_options",items:[{id:"open_library",text:"Import Library...",action:Y.OpenFile,shortcut:o.open_library},{id:"save_library",text:"Export Library",action:Y.RunTask,shortcut:o.save_library}]}]},{publish_options:void 0!==j.publisher})},editMenu(e,t,i){let{edit:s}=i.AppSettingsStore.settings.hotkeys;return{id:"edit_menu",text:"Edit",action:Y.OpenSubmenu,sections:[t.undoRedoMenu,t.clipboardMenu,t.deleteMenu,t.duplicateMenu,t.createMenu,t.selectAllMenu]}},undoRedoMenu(e,t,i,s){let{edit:o}=i.AppSettingsStore.settings.hotkeys;return{id:"undo_redo_options",items:[{id:"undo",text:"Undo",action:Y.RunTask,shortcut:o.undo,disabled:!s["ActivePageStore/canUndo"]},{id:"redo",text:"Redo",action:Y.RunTask,shortcut:o.redo,disabled:!s["ActivePageStore/canRedo"]}]}},clipboardMenu(e,t,i,s){let{edit:o}=i.AppSettingsStore.settings.hotkeys,n=s["ActiveDocumentStore/hasClipboardContents"],r=s["ActivePageStore/hasSelection"];return{id:"clipboard_options",items:[{id:"cut",text:"Cut",action:Y.RunTask,shortcut:o.cut,disabled:!r},{id:"copy",text:"Copy",action:Y.RunTask,shortcut:o.copy,disabled:!r},{id:"paste",text:"Paste",action:Y.RunTask,shortcut:o.paste,disabled:!n}]}},deleteMenu(e,t,i,s){let{edit:o}=i.AppSettingsStore.settings.hotkeys,n=s["ActivePageStore/hasSelection"];return{id:"delete_options",items:[{id:"delete",text:"Delete",action:Y.RunTask,shortcut:o.delete,disabled:!n}]}},duplicateMenu(e,t,i,s){let{edit:o}=i.AppSettingsStore.settings.hotkeys,n=s["ActivePageStore/hasSelection"];return{id:"duplicate_options",items:[{id:"duplicate",text:"Duplicate",action:Y.RunTask,shortcut:o.duplicate,disabled:!n}]}},selectAllMenu(e,t,i){let{edit:s}=i.AppSettingsStore.settings.hotkeys;return{id:"select_options",items:[{id:"select_all",text:"Select All",action:Y.RunTask,shortcut:s.select_all}]}},createMenu(e,t,i){let{document:s}=i.ActiveDocumentStore,o=[];for(let r of s.factory.getBlockTemplates())o.push({id:"create_object",text:r.name,action:Y.RunTask,data:{template:r.id}});let n=[];for(let r of s.factory.getLineTemplates())n.push({id:"create_object",text:r.name,action:Y.RunTask,data:{template:r.id}});return{id:"create_options",items:[{id:"create_menu",text:"Create",action:Y.OpenSubmenu,sections:[{id:"block_objects",items:o},{id:"line_objects",items:n}]}]}},layoutMenu(e,t,i){let{layout:s}=i.AppSettingsStore.settings.hotkeys;return{id:"layout_menu",text:"Layout",action:Y.OpenSubmenu,sections:[t.layeringMenu,{id:"align_options",items:[{id:"align_menu",text:"Align",action:Y.OpenSubmenu,sections:[{id:"horizontal_alignments",items:[{id:"align_left",text:"Align Left",action:Y.RunTask,shortcut:s.align_left},{id:"align_center",text:"Align Center",action:Y.RunTask,shortcut:s.align_center},{id:"align_right",text:"Align Right",action:Y.RunTask,shortcut:s.align_right}]},{id:"vertical_alignments",items:[{id:"align_top",text:"Align Top",action:Y.RunTask,shortcut:s.align_top},{id:"align_middle",text:"Align Middle",action:Y.RunTask,shortcut:s.align_middle},{id:"align_bottom",text:"Align Bottom",action:Y.RunTask,shortcut:s.align_bottom}]}]}]},t.groupingMenu,t.groupMenu]}},layeringMenu(e,t,i){let{layout:s}=i.AppSettingsStore.settings.hotkeys;return{id:"layering_options",items:[{id:"selection_to_front",text:"To Front",action:Y.RunTask,shortcut:s.selection_to_front},{id:"selection_to_back",text:"To Back",action:Y.RunTask,shortcut:s.selection_to_back},{id:"bring_selection_forward",text:"Bring Forward",action:Y.RunTask,shortcut:s.bring_selection_forward},{id:"send_selection_backward",text:"Send Backward",action:Y.RunTask,shortcut:s.send_selection_backward}]}},groupingMenu(e,t,i){let{layout:s}=i.AppSettingsStore.settings.hotkeys;return{id:"grouping_options",items:[{id:"group",text:"Group",action:Y.RunTask,shortcut:s.group},{id:"ungroup",text:"Ungroup",action:Y.RunTask,shortcut:s.ungroup}]}},groupMenu(e,t,i){let{layout:s}=i.AppSettingsStore.settings.hotkeys;return{id:"group_options",items:[{id:"open_group",text:"Open Group",action:Y.RunTask,shortcut:s.open_group},{id:"close_group",text:"Close Group",action:Y.RunTask,shortcut:s.close_group}]}},viewMenu(e,t,i){return{id:"view_menu",text:"View",action:Y.OpenSubmenu,sections:[t.diagramViewMenu,t.diagramRenderMenu,t.zoomMenu,t.jumpMenu,t.fullscreenMenu,t.developerViewMenu]}},diagramViewMenu(e,t,i){let{view:s}=i.AppSettingsStore.settings.hotkeys,{display_grid:o,display_shadows:n}=i.AppSettingsStore.settings.view.diagram;return{id:"diagram_view_options",items:[{id:"toggle_grid",text:"Grid",action:Y.ToggleValue,shortcut:s.toggle_grid,value:o},{id:"toggle_shadows",text:"Shadows",action:Y.ToggleValue,shortcut:s.toggle_shadows,value:n}]}},diagramRenderMenu(e,t,i){let{render_high_quality:s}=i.AppSettingsStore.settings.view.diagram;return{id:"diagram_render_quality",items:[{id:"enable_high_quality_render",text:"Rendering – High Quality",action:Y.ToggleValue,value:s},{id:"enable_low_quality_render",text:"Rendering – Fast",action:Y.ToggleValue,value:!s}]}},zoomMenu(e,t,i){let{view:s}=i.AppSettingsStore.settings.hotkeys;return{id:"zoom_options",items:[{id:"reset_view",text:"Reset View",action:Y.RunTask,shortcut:s.reset_view},{id:"zoom_in",text:"Zoom In",action:Y.RunTask,shortcut:s.zoom_in},{id:"zoom_out",text:"Zoom Out",action:Y.RunTask,shortcut:s.zoom_out}]}},jumpMenu(e,t,i,s){let{view:o}=i.AppSettingsStore.settings.hotkeys,n=s["ActivePageStore/hasSelection"];return{id:"jump_options",items:[{id:"jump_to_selection",text:"Zoom to Selection",action:Y.RunTask,shortcut:o.jump_to_selection,disabled:!n},{id:"jump_to_parents",text:"Jump to Parents",action:Y.RunTask,shortcut:o.jump_to_parents,disabled:!n},{id:"jump_to_children",text:"Jump to Children",action:Y.RunTask,shortcut:o.jump_to_children,disabled:!n}]}},fullscreenMenu(e,t,i){let{view:s}=i.AppSettingsStore.settings.hotkeys;return{id:"fullscreen_options",items:[{id:"fullscreen",text:"Fullscreen",action:Y.RunTask,shortcut:s.fullscreen}]}},developerViewMenu(e,t,i){let{view:s}=i.AppSettingsStore.settings.hotkeys,{display_debug_mode:o}=i.AppSettingsStore.settings.view.diagram;return{id:"developer_view_options",items:[{id:"toggle_debug_view",text:"Debug Mode",action:Y.ToggleValue,shortcut:s.toggle_debug_view,value:o}]}},helpMenu(){let e=j.help_links;return{id:"help_menu",text:"Help",action:Y.OpenSubmenu,sections:[{id:"help_links",items:e.map(e=>({id:"open_help_link",text:e.text,action:Y.OpenLink,link:e.url}))},{id:"about",items:[{id:"open_about_window",text:"About",action:Y.RunTask}]}]}}}};function Tt(e,t={}){if(!(e.id in t)||t[e.id]){if(e.action!==Y.OpenSubmenu)return e;for(let i=e.sections.length-1;0<=i;i--){let s=e.sections[i];if(s.id in t&&!t[s.id])e.sections.splice(i,1);else{for(let e=s.items.length-1;0<=e;e--){let i=s.items[e];i.id in t&&!t[i.id]?s.items.splice(e,1):i.action===Y.OpenSubmenu&&(Tt(i,t),0===i.sections.length&&s.items.splice(e,1))}0===s.items.length&&e.sections.splice(i,1)}}return 0===e.sections.length?void 0:e}}var At={namespaced:!0,getters:{nativeHotkeys(){return[{id:"refresh",action:de.RunTask,shortcut:"Control+R",allowBrowserBehavior:!0},{id:"hard-refresh",action:de.RunTask,shortcut:"Control+Shift+R",allowBrowserBehavior:!0}]},fileHotkeys(e,t,i){let{file:s}=i.AppSettingsStore.settings.hotkeys;return[{id:"new_file",action:de.RunTask,shortcut:s.new_file},{id:"open_file",action:de.OpenFile,shortcut:s.open_file},{id:"save_file",action:de.RunTask,shortcut:s.save_file},{id:"save_image",action:de.RunTask,shortcut:s.save_image},{id:"save_select_image",action:de.RunTask,shortcut:s.save_select_image},{id:"publish_file",action:de.RunTask,shortcut:s.publish_file},{id:"open_library",action:de.OpenFile,shortcut:s.open_library},{id:"save_library",action:de.RunTask,shortcut:s.save_library}]},editHotKeys(e,t,i){let s={delay:400,interval:50},{edit:o}=i.AppSettingsStore.settings.hotkeys;return[{id:"undo",action:de.RunTask,shortcut:o.undo,repeat:s},{id:"redo",action:de.RunTask,shortcut:o.redo,repeat:s},{id:"cut",action:de.RunTask,shortcut:o.cut},{id:"copy",action:de.RunTask,shortcut:o.copy},{id:"paste",action:de.RunTask,shortcut:o.paste},{id:"delete",action:de.RunTask,shortcut:o.delete},{id:"duplicate",action:de.RunTask,shortcut:o.duplicate},{id:"select_all",action:de.RunTask,shortcut:o.select_all}]},layoutHotkeys(e,t,i){let{layout:s}=i.AppSettingsStore.settings.hotkeys;return[{id:"selection_to_front",action:de.RunTask,shortcut:s.selection_to_front},{id:"selection_to_back",action:de.RunTask,shortcut:s.selection_to_back},{id:"bring_selection_forward",action:de.RunTask,shortcut:s.bring_selection_forward},{id:"send_selection_backward",action:de.RunTask,shortcut:s.send_selection_backward},{id:"align_left",action:de.RunTask,shortcut:s.align_left},{id:"align_center",action:de.RunTask,shortcut:s.align_center},{id:"align_right",action:de.RunTask,shortcut:s.align_right},{id:"align_top",action:de.RunTask,shortcut:s.align_top},{id:"align_middle",action:de.RunTask,shortcut:s.align_middle},{id:"align_bottom",action:de.RunTask,shortcut:s.align_bottom},{id:"group",action:de.RunTask,shortcut:s.group},{id:"ungroup",action:de.RunTask,shortcut:s.ungroup},{id:"open_group",action:de.RunTask,shortcut:s.open_group},{id:"close_group",action:de.RunTask,shortcut:s.close_group}]},viewHotkeys(e,t,i){let{view:s}=i.AppSettingsStore.settings.hotkeys,{display_grid:o,display_shadows:n,display_debug_mode:r}=i.AppSettingsStore.settings.view.diagram;return[{id:"toggle_grid",action:de.ToggleValue,shortcut:s.toggle_grid,value:o},{id:"toggle_shadows",action:de.ToggleValue,shortcut:s.toggle_shadows,value:n},{id:"reset_view",action:de.RunTask,shortcut:s.reset_view},{id:"zoom_in",action:de.RunTask,shortcut:s.zoom_in},{id:"zoom_out",action:de.RunTask,shortcut:s.zoom_out},{id:"jump_to_selection",action:de.RunTask,shortcut:s.jump_to_selection},{id:"jump_to_parents",action:de.RunTask,shortcut:s.jump_to_parents},{id:"jump_to_children",action:de.RunTask,shortcut:s.jump_to_children},{id:"fullscreen",action:de.RunTask,shortcut:s.fullscreen},{id:"toggle_debug_view",action:de.ToggleValue,shortcut:s.toggle_debug_view,value:r}]}}},Ct=Object(a["a"])({modules:{ActiveDocumentStore:xt,ActivePageStore:_t,AppActionsStore:kt,AppSettingsStore:St,ContextMenuStore:Mt,HotkeyStore:At}});i("0da8");Object(s["c"])(mt).use(Ct).mount("#app")},ceb6:function(e,t,i){},de5a:function(e,t,i){"use strict";i("9ce6")},e37d:function(e,t,i){"use strict";i.d(t,"f",(function(){return r})),i.d(t,"g",(function(){return a})),i.d(t,"i",(function(){return c})),i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return g})),i.d(t,"h",(function(){return f}));var s=i("5368"),o=i("317b"),n=i("1dd9");class r{constructor(e,t,i){var r,a,c,d,h;if(this.id=null!==(r=null===i||void 0===i?void 0:i.id)&&void 0!==r?r:crypto.randomUUID(),this.attrs=null!==(a=null===i||void 0===i?void 0:i.attrs)&&void 0!==a?a:n["j"].False,this.setAlignment(n["a"].Free),this.setCursor(n["c"].Default),this.setInheritAlignment(n["h"].True),this.setSemanticRole(o["e"].None),this.children=[],this.factory=e,this.template=t,this.boundingBox=new l,this.boundingBox.xMid=null!==(c=null===i||void 0===i?void 0:i.x)&&void 0!==c?c:0,this.boundingBox.yMid=null!==(d=null===i||void 0===i?void 0:i.y)&&void 0!==d?d:0,this.props=s["f"].create({type:s["g"].Dictionary,form:null!==(h=null===t||void 0===t?void 0:t.properties)&&void 0!==h?h:{},text_key:""},null===i||void 0===i?void 0:i.properties),null===i||void 0===i?void 0:i.children)for(let s=0;s<i.children.length;s++)this.addChild(i.children[s],s,!1)}*getSubtree(e){let t=new Set([this.id]),i=[this];while(0!=i.length){let s=i.shift();if(e&&!e(s)||(yield s),!(s instanceof d))for(let e of s.children)t.has(e.id)||(t.add(e.id),i.push(e))}}addChild(e,t=this.children.length,i=!0){if(this.hasChild(e.id))throw new a(`Object already has a child with the id '${e.id}'.`,this);e.parent=this,this.children.splice(t,0,e),i&&this.updateLayout(c.ChildAdded)}reorderChild(e,t,i=!0){let s=this.children.findIndex(t=>t.id===e),o=this.children[s];if(!o)throw new a(`Object has no child with the id '${e}'.`);this.children.splice(s,1),this.children.splice(t,0,o),i&&this.updateLayout(c.Movement)}removeChild(e,t=!0,i=!0){let s=this.children.findIndex(t=>t.id===e),o=this.children[s];if(o){if(i&&o.hasExternalAttachments())throw new a(`'${o.id}' still maintains external attachments.`,o);o.parent=void 0,this.children.splice(s,1),t&&this.updateLayout(c.ChildDeleted)}}hasChild(e){return void 0!==this.children.find(t=>t.id===e)}hasExternalAttachments(){let e=new Map;for(let t of this.getSubtree())(t instanceof d||t instanceof h)&&e.set(t.id,t);for(let t of e.values())if(t instanceof h){if(t.isAttached()&&!e.has(t.anchor.id))return!0}else if(t instanceof d)for(let i of t.children)if(!e.has(i.id))return!0;return!1}getIndexInParent(){var e,t;return null!==(t=null===(e=this.parent)||void 0===e?void 0:e.children.indexOf(this))&&void 0!==t?t:-1}getObjectAt(e,t){let i=void 0,s=void 0;for(let o=this.children.length-1;0<=o;o--){let r=this.children[o];if(!(r instanceof h&&r.isAttached())&&(s=r.getObjectAt(e,t),s&&(!i||s.hasHigherPriorityThan(i))&&(i=s,i.getPriority()===n["l"].High)))break}return i}moveTo(e,t,i=!0){this.moveBy(e-this.boundingBox.xMid,t-this.boundingBox.yMid,i)}moveBy(e,t,i=!0){this.boundingBox.xMin+=e,this.boundingBox.xMid+=e,this.boundingBox.xMax+=e,this.boundingBox.yMin+=t,this.boundingBox.yMid+=t,this.boundingBox.yMax+=t;let s=!0;for(let o of this.children)o instanceof h&&o.isAttached()||(s=!1,o.moveBy(e,t));s&&this.updateLayout(c.Movement,i)}setProperty(e,t){e instanceof s["h"]&&(e.value=t,this.updateLayout(c.PropertyChange))}updateLayout(e,t=!0){var i;let s=this.boundingBox;s.xMin=1/0,s.yMin=1/0,s.xMax=-1/0,s.yMax=-1/0;let o=n["a"].Free;for(let n of this.children)s.xMin=Math.min(s.xMin,n.boundingBox.xMin),s.yMin=Math.min(s.yMin,n.boundingBox.yMin),s.xMax=Math.max(s.xMax,n.boundingBox.xMax),s.yMax=Math.max(s.yMax,n.boundingBox.yMax),o=Math.max(o,n.getAlignment());s.xMid=Math.floor((s.xMin+s.xMax)/2),s.yMid=Math.floor((s.yMin+s.yMax)/2),this.isAlignmentInherited()&&this.setAlignment(o),t&&(null===(i=this.parent)||void 0===i||i.updateLayout(e))}getAlignment(e=this.attrs){return e&n["b"]}getCursor(e=this.attrs){return e&n["e"]}isHovered(e=this.attrs){return(e&n["g"])!==n["f"].Off}isHoveredOrSelected(e=this.attrs){return 0<(e&(n["o"]|n["g"]))}isAlignmentInherited(e=this.attrs){return(e&n["i"])===n["h"].True}hasUserSetPosition(e=this.attrs){return(e&n["k"])===n["j"].True}getPositionSetByUser(e=this.attrs){return e&n["k"]}getPriority(e=this.attrs){return e&n["m"]}hasHigherPriorityThan(e){return this.getPriority()>e.getPriority()}isSelected(e=this.attrs){return(e&n["o"])!==n["n"].Unselected}getSemanticRole(e=this.attrs){return e&n["p"]}hasRole(e,t=this.attrs){return(t&n["p"])===e}setAlignment(e){this.attrs=this.attrs&~n["b"]|e}setCursor(e){this.attrs=this.attrs&~n["e"]|e}setHover(e){this.attrs=this.attrs&~n["g"]|e}setInheritAlignment(e){this.attrs=this.attrs&~n["i"]|e}setPositionSetByUser(e){this.attrs=this.attrs&~n["k"]|e}setPriority(e){this.attrs=this.attrs&~n["m"]|e}setSelect(e){this.attrs=this.attrs&~n["o"]|e}setSemanticRole(e){this.attrs=this.attrs&~n["p"]|e}toExport(){return{id:this.id,x:this.boundingBox.xMid,y:this.boundingBox.yMid,attrs:this.getPositionSetByUser(),template:this.template.id,children:this.children.map(e=>e.id),properties:this.props.toRawValue()}}}class a extends Error{constructor(e,t){super(e),this.subject=t}}class l{constructor(){this.xMin=0,this.yMin=0,this.xMid=0,this.yMid=0,this.xMax=0,this.yMax=0}}const c={Movement:1,ChildAdded:2,ChildDeleted:4,ObjectInit:8,PropertyChange:16};class d extends r{constructor(e,t,i){var s;super(e,t,i),this.radius=t.radius,this.template=t,this.lineTemplates=t.line_templates,this.angle=null!==(s=null===i||void 0===i?void 0:i.angle)&&void 0!==s?s:o["a"].DEG_0}addChild(e,t=this.children.length){if(!(e instanceof h))throw new a(`'${e.id}' must be of type '${d.name}.'`,e);if(e.isAttached())throw new a(`'${e.id}' is already anchored.`,e);if(this.hasChild(e.id))throw new a(`Anchor already has a child with the id '${e.id}'.`,this);e.anchor=this,this.children.splice(t,0,e)}removeChild(e){let t=this.children.findIndex(t=>t.id===e),i=this.children[t];if(i){if(!(i instanceof h))throw new a(`'${e}' is not an '${h.name}.'`,i);i.anchor=void 0,this.children.splice(t,1)}}hasAttachments(){return 0<this.children.length}getObjectAt(e,t){let i=void 0,s=void 0;for(let l=this.children.length-1;0<=l;l--)if(s=this.children[l].getObjectAt(e,t),s&&(!i||s.hasHigherPriorityThan(i))&&(i=s,i.getPriority()===n["l"].High))break;let o=this.radius,r=e-this.boundingBox.xMid,a=t-this.boundingBox.yMid;return i&&i.getPriority()>n["l"].Normal?i:r*r+a*a<o*o?this:void 0}moveBy(e,t,i=!0){this.boundingBox.xMin+=e,this.boundingBox.xMid+=e,this.boundingBox.xMax+=e,this.boundingBox.yMin+=t,this.boundingBox.yMid+=t,this.boundingBox.yMax+=t;for(let s of this.children)s.isAttached(this)?s.moveTo(this.boundingBox.xMid,this.boundingBox.yMid):console.warn(`'${s.id}' incorrectly attached to anchor.`);this.updateLayout(c.Movement,i)}updateLayout(e,t=!0){var i;let s=this.boundingBox;s.xMin=s.xMid-this.radius,s.yMin=s.yMid-this.radius,s.xMax=s.xMid+this.radius,s.yMax=s.yMid+this.radius,t&&(null===(i=this.parent)||void 0===i||i.updateLayout(e))}toExport(){return Object.assign(Object.assign({},super.toExport()),{angle:this.angle})}makeLine(){let e=this.lineTemplates[this.angle],t=this.factory.createObject(e);if(t instanceof g)return t;throw new a(`Template '${e}' is not a line.`,t)}}class h extends r{constructor(e,t,i){super(e,t,i),this.anchor=void 0}isAttached(e){return e?this.anchor===e:void 0!==this.anchor}getIndexInAnchor(){var e,t;return null!==(t=null===(e=this.anchor)||void 0===e?void 0:e.children.indexOf(this))&&void 0!==t?t:-1}}class u extends h{constructor(e,t,i){super(e,t,i)}moveBy(e,t,i=!0,s=!1){var o;s?super.moveBy(e,t,i):null===(o=this.parent)||void 0===o||o.moveChild(this.id,e,t,i)}}class p extends r{constructor(e,t,i){super(e,t,i)}moveBy(e,t,i=!0,s=!1){var o;s?super.moveBy(e,t,i):null===(o=this.parent)||void 0===o||o.moveChild(this.id,e,t,i)}}class g extends r{constructor(e,t,i){super(e,t,i),this.style=t.style,this.template=t,this.hitboxWidth=t.hitbox_width}get srcEnding(){return this.children.at(0)}get trgEnding(){return this.children.at(-1)}addChild(e,t=this.children.length,i=!0){if(!(e instanceof u||e instanceof p)){let t=u.name,i=p.name;throw new a(`Child must be of type '${t}' or '${i}.'`,e)}super.addChild(e,t,i)}reorderChild(e,t,i=!0){throw new a("Line objects cannot be reordered.",this)}isAnchored(){for(let e of this.children)if(e instanceof u&&e.isAttached())return!0;return!1}setSelect(e){super.setSelect(e);let t=this.isSelected()?n["l"].High:n["l"].Normal;for(let i of this.children)i.setPriority(t)}}class f extends r{constructor(e,t,i){super(e,t,i),this.anchorCache=[],this._objectCache=new Map([[this.id,this]])}lookup(e){return this._objectCache.get(e)}updateLayout(e){let{ChildAdded:t,ChildDeleted:i,ObjectInit:s}=c;if(super.updateLayout(e),e&(s|t|i)){this._objectCache.clear(),this.anchorCache.splice(0,this.anchorCache.length);for(let e of this.getSubtree())e instanceof d&&this.anchorCache.push(e),this._objectCache.set(e.id,e)}}}},e5f1:function(e,t,i){"use strict";i("97e0")}});
//# sourceMappingURL=app.d3101019.js.map