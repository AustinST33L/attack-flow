{"$schema":"./attack_flow_2022-06-02_20-34-52.json","flow":{"type":"attack-flow","id":"http://flow-1","name":"Attack Flow Export","author":"Unspecified","created":"2022-06-02T16:34:52-04:00"},"actions":[{"id":"http://flow-1/action-2","type":"action","name":" T1110 Brute Force","description":"Initial compromise is through the RDP service, and the attacker can brute forcing passwords ","timestamp":"","reference":"\"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"OR"},{"id":"http://flow-1/action-3","type":"action","name":"T1078 Valid Accounts","description":"Initial compromise is through the RDP service, and the attacker can use stolen credentials from the black market","timestamp":"","reference":"\"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"OR"},{"id":"http://flow-1/action-6","type":"action","name":" TA0043 Reconaissance","description":"The attacker performs second-stage reconaissance","timestamp":"","reference":"\"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-8","type":"action","name":"T1068 Exploitation for Privilege Escalation","description":"The threat actor elevates privileges by exploiting CVE-2017-0213. This allows the attacker to run arbitrary code with elevated privileges. POC code is available that abuses the BITS SetNotifyInterface to get a type library loaded under impersonation, and causes it to load a type library which references a scriptlet moniker which gets us code execution inside the BITS service. The result is a new cmd window with system privileges.","timestamp":"","reference":"\"https://www.miltonsecurity.com/company/blog/cve-2017-0213-windows-com-privilege-escalation-vulnerability\", \"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-12","type":"action","name":"T1564.006 Hide Artifacts: Run Virtual Instance","description":"The attacker deploys a VirtualBox VM and loads a Windows XP image","timestamp":"","reference":"\"https://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/\", \"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-14","type":"action","name":"T1562.001 Impair Defenses: Disable or Modify Tools","description":"Next, it references a list of services to be terminated by Ragnar Locker that include strings related to backup and antivirus solutions (such as ‘sophos’ and ‘veeam’), as well as remote management software (RMM) tools like ConnectWise and Kaseya that are typically used by managed service providers (MSPs).","timestamp":"","reference":"\"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-15","type":"action","name":"T1490 Inhibit System Recovery","description":"The ransomware deletes shadow copies","timestamp":"","reference":"\"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-22","type":"action","name":"T1537 Transfer Data to Cloud Account","description":"The ransomware steals files and uploads them in case the victim refuses to pay the ransomware","timestamp":"","reference":"\"https://www.avertium.com/resources/threat-reports/ragnar-locker-ransomware-attacks-analysis\" \"https://www.zscaler.com/blogs/security-research/threatlabz-ransomware-review-advent-double-extortion\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-24","type":"action","name":" T1614.001 System Location Discovery: System Language Discovery","description":"One of the first things the ransomware checks is language. Locale information is checked to make sure CIS countries are not infected. If the machine’s default language matches one on the CIS list, the ransomware process is terminated with the “666” exit code.","timestamp":"","reference":"\"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\", \"https://www.avertium.com/resources/threat-reports/ragnar-locker-ransomware-attacks-analysis\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-26","type":"action","name":"T1486 Data Encrypted for Impact","description":"Ragnar Locker then commences the encryption process in 64 simultaneous threads. The encrypted file contains the encrypted Salsa20 key data (40+32 bytes) with the signature ‘_RAGNAR_’ added to the footer at the very end. The ransomware note is displayed. ","timestamp":"","reference":"\"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-29","type":"action","name":"T1218.007 System Binary Proxy Execution: Msiexec ","description":"Ragnar has used admin tools such as PowerShell or GPO to move laterally to other Windows machines. In some attacks, the ransomware has been observed using a GPO task to execute Microsoft Installer, which downloads a Windows XP image and an old Oracle VirtualBox","timestamp":"","reference":"\"https://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/\" \"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-32","type":"action","name":"T1120 Peripheral Device Discovery","description":"The specially-crafted VM image is loaded to the VirtualBox VM, mapping all local drives as read/writable into the virtual machine. This allows the ransomware process running inside the VM to encrypt all files. ","timestamp":"","reference":"\"https://www.acronis.com/en-us/blog/posts/ragnar-locker/\"","succeeded":0,"confidence":0,"logic_operator_language":"","logic_operator":"AND"}],"assets":[{"id":"http://flow-1/asset-5","type":"asset","state":"RDP Credentials"},{"id":"http://flow-1/asset-7","type":"asset","state":"Machine"},{"id":"http://flow-1/asset-11","type":"asset","state":"Machine"},{"id":"http://flow-1/asset-13","type":"asset","state":"Admin Tools"},{"id":"http://flow-1/asset-18","type":"asset","state":"Local Drives"},{"id":"http://flow-1/asset-21","type":"asset","state":"Target Data"},{"id":"http://flow-1/asset-25","type":"asset","state":"Machine"},{"id":"http://flow-1/asset-27","type":"asset","state":"Data"},{"id":"http://flow-1/asset-34","type":"asset","state":"Machine"},{"id":"http://flow-1/asset-37","type":"asset","state":"Shadow Copies"}],"relationships":[{"source":"http://flow-1/action-2","type":"http://flow-1#Compromises","target":"http://flow-1/asset-5"},{"source":"http://flow-1/action-3","type":"http://flow-1#Compromises","target":"http://flow-1/asset-5"},{"source":"http://flow-1/asset-5","type":"http://flow-1#Compromised","target":"http://flow-1/action-6"},{"source":"http://flow-1/action-6","type":"http://flow-1#Compromises","target":"http://flow-1/asset-7"},{"source":"http://flow-1/asset-7","type":"http://flow-1#Compromised","target":"http://flow-1/action-8"},{"source":"http://flow-1/action-8","type":"http://flow-1#Compromises","target":"http://flow-1/asset-11"},{"source":"http://flow-1/action-22","type":"http://flow-1#Compromises","target":"http://flow-1/asset-27"},{"source":"http://flow-1/asset-11","type":"http://flow-1#Compromised","target":"http://flow-1/action-29"},{"source":"http://flow-1/action-29","type":"http://flow-1#Compromises","target":"http://flow-1/asset-13"},{"source":"http://flow-1/asset-13","type":"http://flow-1#Compromised","target":"http://flow-1/action-12"},{"source":"http://flow-1/action-12","type":"http://flow-1#Compromises","target":"http://flow-1/asset-34"},{"source":"http://flow-1/asset-34","type":"http://flow-1#Compromised","target":"http://flow-1/action-32"},{"source":"http://flow-1/action-32","type":"http://flow-1#Compromises","target":"http://flow-1/asset-18"},{"source":"http://flow-1/asset-18","type":"http://flow-1#Compromised","target":"http://flow-1/action-22"},{"source":"http://flow-1/asset-27","type":"http://flow-1#Compromised","target":"http://flow-1/action-24"},{"source":"http://flow-1/action-24","type":"http://flow-1#Compromises","target":"http://flow-1/asset-25"},{"source":"http://flow-1/asset-25","type":"http://flow-1#Compromised","target":"http://flow-1/action-14"},{"source":"http://flow-1/action-14","type":"http://flow-1#Compromises","target":"http://flow-1/asset-21"},{"source":"http://flow-1/asset-21","type":"http://flow-1#Compromised","target":"http://flow-1/action-15"},{"source":"http://flow-1/action-15","type":"http://flow-1#Compromises","target":"http://flow-1/asset-37"},{"source":"http://flow-1/asset-37","type":"http://flow-1#Compromised","target":"http://flow-1/action-26"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-2"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-3"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-6"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-8"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-12"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-14"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-15"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-22"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-24"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-26"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-29"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-32"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-5"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-7"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-11"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-13"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-18"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-21"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-25"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-27"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-34"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-37"}],"object_properties":[],"data_properties":[{"source":"http://flow-1/action-8","type":"http://flow-1#Description-","target":"Windows COM Vulnerability"},{"source":"http://flow-1/action-14","type":"http://flow-1#Description-","target":"Anti-virus"},{"source":"http://flow-1/action-14","type":"http://flow-1#Description-","target":"Remote Management"},{"source":"http://flow-1/asset-21","type":"http://flow-1#Description-","target":"Released and Available for Encryption "},{"source":"http://flow-1/asset-27","type":"http://flow-1#Description-","target":"Exfiltrated"},{"source":"http://flow-1/asset-18","type":"http://flow-1#Description-","target":"Mappable to VM"},{"source":"http://flow-1/asset-37","type":"http://flow-1#Description-","target":"Deleted"}]}