{"$schema":"./attack_flow_2022-06-13_14-55-37.json","flow":{"type":"attack-flow","id":"http://flow-1","name":"Attack Flow Export","author":"Unspecified","created":"2022-06-13T10:55:37-04:00"},"actions":[{"id":"http://flow-1/action-3","type":"action","name":"T1036 Masquerading","description":"NotPetya drops the ransomware DLL perfc.dat. Part of the malware decompresses to dllhost.dat, which is actually PsExec utility","timestamp":"","reference":"\"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\", \"https://attack.mitre.org/techniques/T1036/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-4","type":"action","name":"T1195 Supply Chain Compromise","description":"Sandworm likely installs backdoor within MeDoc software to compromise automatic update roll-out","timestamp":"","reference":"\"https://attack.mitre.org/techniques/T1195/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-7","type":"action","name":"T1518.001 Software Discovery: Security Software Discovery","description":"Malware starts subroutine and hashes every running process on the system and sets PROC_FLAG. It is looking for three hardcoded hashes: Kaspersky, Symantec, Norton. Which antivirus are present dictates how the malware will act. ","timestamp":"","reference":"\"https://gallery.logrhythm.com/threat-intelligence-reports/notpetya-technical-analysis-logrhythm-labs-threat-intelligence-report.pdf\", \"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\", \"https://attack.mitre.org/techniques/T1518/001/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-9","type":"action","name":"Malware Privilege Discovery ","description":"Malware attempts to determine privilege of running process and gain various levels of privilege: SeTcbPrivilege, SeDebugPrivilege, SeShutdownPrivilege","timestamp":"","reference":"\"https://gallery.logrhythm.com/threat-intelligence-reports/notpetya-technical-analysis-logrhythm-labs-threat-intelligence-report.pdf\", \"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\", ","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-15","type":"action","name":"T1134.001 Access Token Impersonation","description":"Duplicates another user's token and allows attacker to escalate privileges and impersonate another user to spread the malware. This step requires SeTcbPrivilege and is a form of defense evasion. ","timestamp":"","reference":"\"https://attack.mitre.org/techniques/T1134/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"OR"},{"id":"http://flow-1/action-21","type":"action","name":"T1003.001 OS Credential Dumping: LSASS Memory","description":"Operated as a modified version of Mimikatz, extracted credentials from LSASS. However, this step is unnecessary if the malware is able to obtain SeDebug privileges","timestamp":"","reference":"\"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\", \"https://attack.mitre.org/techniques/T1003/001/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"OR"},{"id":"http://flow-1/action-39","type":"action","name":"T1021.002 Remote Services: SMB/Windows Admin Shares","description":"Logs into any version of SMB with the stolen tokens and harvested credentials obtained previously","timestamp":"","reference":"\"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\", \"https://attack.mitre.org/techniques/T0866/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"OR"},{"id":"http://flow-1/action-42","type":"action","name":"T1016 System Network Configuration Discovery","description":"Malware issues commands to gather list of known IP addresses and TCP endpoints and enumerate domain controllers","timestamp":"","reference":"\"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-45","type":"action","name":"T0866 Exploitation of Remote Services ","description":"NotPetya tests for vulnerable SMBv1 condition (Eternal Blue/Romance exploit), checks the Windows version, deploys an SMB backdoor. This routine is not executed if Norton Security or Symantec are present on the system.  ","timestamp":"","reference":"\"https://attack.mitre.org/techniques/T0866/\", \"https://www.crowdstrike.com/blog/petrwrap-technical-analysis-part-2-further-findings-and-potential-for-mbr-recovery/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"OR"},{"id":"http://flow-1/action-49","type":"action","name":"T1218.011 System Binary Proxy Execution: Rundll32","description":"Malware is written to Admin$ and executes either using PsExec or WMIC as rundll32.exe","timestamp":"","reference":"\"https://attack.mitre.org/techniques/T1218/\", \"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\" \"https://www.crowdstrike.com/blog/petrwrap-technical-analysis-part-2-further-findings-and-potential-for-mbr-recovery/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"OR"},{"id":"http://flow-1/action-53","type":"action","name":"T1218.011 System Binary Proxy Execution: Rundll32","description":"NotPetya written to c:/windows and executed as rundll32.exe","timestamp":"","reference":"\"https://attack.mitre.org/techniques/T1218/\", \"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"OR"},{"id":"http://flow-1/action-57","type":"action","name":"T1542.003 Pre-OS Boot: BootKit","description":"Malware reads and encodes MBR, overrides with custom boot loader, includes Bitcoin wallet and randomly generated personal installation key for user. If Kaspersky is present on the system, NotPetya will not encrypt the MFT but will still render the machine unbootable, though possible to recover MBR. ","timestamp":"","reference":"\"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\"https://www.crowdstrike.com/blog/petrwrap-technical-analysis-part-2-further-findings-and-potential-for-mbr-recovery/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-63","type":"action","name":"T1529 System Shutdown/Reboot","description":"System reboots, displays decoy, custom boot loader encrypts","timestamp":"","reference":"\"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-67","type":"action","name":"T1070.001 Indicator Removal on Host: Clear Windows Event Logs","description":"NotPetya uses wevtutil to clear the Windows event logs","timestamp":"","reference":"\"https://attack.mitre.org/techniques/T1070/001/\", \"https://www.justice.gov/opa/press-release/file/1328521/download\", \"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-79","type":"action","name":"T1529 System Shutdown/Reboot","description":"Second reboot, ransomware note displayed","timestamp":"","reference":"\"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-86","type":"action","name":"T1486 Data Encrypted for Impact","description":"The data is encrypted","timestamp":"","reference":"\"https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"AND"},{"id":"http://flow-1/action-96","type":"action","name":"T1055 Process Injection","description":"Rundll32.exe is injected into lsass.exe","timestamp":"","reference":"\"https://www.crowdstrike.com/blog/petrwrap-technical-analysis-part-2-further-findings-and-potential-for-mbr-recovery/\"","succeeded":1,"confidence":1,"logic_operator_language":"","logic_operator":"OR"}],"assets":[{"id":"http://flow-1/asset-1","type":"asset","state":"Compromised"},{"id":"http://flow-1/asset-8","type":"asset","state":"Compromised"},{"id":"http://flow-1/asset-23","type":"asset","state":"Obtained"},{"id":"http://flow-1/asset-26","type":"asset","state":"Compromised"},{"id":"http://flow-1/asset-43","type":"asset","state":"Enumerated"},{"id":"http://flow-1/asset-48","type":"asset","state":"Compromised"},{"id":"http://flow-1/asset-52","type":"asset","state":"Compromised"},{"id":"http://flow-1/asset-56","type":"asset","state":"Compromised"},{"id":"http://flow-1/asset-61","type":"asset","state":"Compromised"},{"id":"http://flow-1/asset-68","type":"asset","state":"Encrypted"},{"id":"http://flow-1/asset-81","type":"asset","state":"Compromised"},{"id":"http://flow-1/asset-85","type":"asset","state":"Compromised"},{"id":"http://flow-1/asset-97","type":"asset","state":"Compromised"}],"relationships":[{"source":"http://flow-1/asset-1","type":"http://flow-1#State","target":"http://flow-1/action-3"},{"source":"http://flow-1/action-4","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-1"},{"source":"http://flow-1/action-3","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-8"},{"source":"http://flow-1/asset-8","type":"http://flow-1#State","target":"http://flow-1/action-9"},{"source":"http://flow-1/asset-23","type":"http://flow-1#State","target":"http://flow-1/action-21"},{"source":"http://flow-1/asset-23","type":"http://flow-1#State","target":"http://flow-1/action-15"},{"source":"http://flow-1/action-9","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-23"},{"source":"http://flow-1/action-15","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-26"},{"source":"http://flow-1/action-21","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-26"},{"source":"http://flow-1/asset-8","type":"http://flow-1#State","target":"http://flow-1/action-7"},{"source":"http://flow-1/asset-26","type":"http://flow-1#State","target":"http://flow-1/action-42"},{"source":"http://flow-1/action-42","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-43"},{"source":"http://flow-1/asset-43","type":"http://flow-1#State","target":"http://flow-1/action-39"},{"source":"http://flow-1/asset-43","type":"http://flow-1#State","target":"http://flow-1/action-45"},{"source":"http://flow-1/action-39","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-48"},{"source":"http://flow-1/asset-48","type":"http://flow-1#State","target":"http://flow-1/action-49"},{"source":"http://flow-1/action-45","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-52"},{"source":"http://flow-1/action-49","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-56"},{"source":"http://flow-1/action-53","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-56"},{"source":"http://flow-1/asset-56","type":"http://flow-1#State","target":"http://flow-1/action-57"},{"source":"http://flow-1/action-57","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-61"},{"source":"http://flow-1/asset-61","type":"http://flow-1#State","target":"http://flow-1/action-63"},{"source":"http://flow-1/action-63","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-68"},{"source":"http://flow-1/asset-68","type":"http://flow-1#State","target":"http://flow-1/action-67"},{"source":"http://flow-1/asset-81","type":"http://flow-1#State","target":"http://flow-1/action-79"},{"source":"http://flow-1/action-67","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-81"},{"source":"http://flow-1/action-79","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-85"},{"source":"http://flow-1/asset-85","type":"http://flow-1#State","target":"http://flow-1/action-86"},{"source":"http://flow-1/asset-52","type":"http://flow-1#State","target":"http://flow-1/action-96"},{"source":"http://flow-1/action-96","type":"http://flow-1#State-Changed","target":"http://flow-1/asset-97"},{"source":"http://flow-1/asset-97","type":"http://flow-1#State-Changed","target":"http://flow-1/action-53"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-3"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-4"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-7"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-9"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-15"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-21"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-39"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-42"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-45"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-49"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-53"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-57"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-63"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-67"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-79"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-86"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/action-96"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-1"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-8"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-23"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-26"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-43"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-48"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-52"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-56"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-61"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-68"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-81"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-85"},{"source":"http://flow-1","type":"http://flow-1#flow-edge","target":"http://flow-1/asset-97"}],"object_properties":[],"data_properties":[{"source":"http://flow-1/action-7","type":"http://flow-1#Description","target":"Kaspersky "},{"source":"http://flow-1/action-7","type":"http://flow-1#Description","target":"Norton Security"},{"source":"http://flow-1/action-7","type":"http://flow-1#Description-","target":"Symantec"},{"source":"http://flow-1/asset-43","type":"http://flow-1#Description","target":"Network Assets"},{"source":"http://flow-1/asset-61","type":"http://flow-1#Description","target":"Physical Drive"},{"source":"http://flow-1/asset-68","type":"http://flow-1#Description","target":"Data"},{"source":"http://flow-1/action-9","type":"http://flow-1#Description-","target":"SeTcbPrivilege"},{"source":"http://flow-1/action-9","type":"http://flow-1#Description","target":"SeDebugPrivilege"},{"source":"http://flow-1/action-9","type":"http://flow-1#Description","target":"SeShutdownPrivilege"},{"source":"http://flow-1/asset-52","type":"http://flow-1#Description-","target":"Remote Machine"},{"source":"http://flow-1/asset-1","type":"http://flow-1#Description","target":"MeDoc Software"},{"source":"http://flow-1/asset-23","type":"http://flow-1#Description","target":"System Privileges"},{"source":"http://flow-1/asset-26","type":"http://flow-1#Description-","target":"Credentials"},{"source":"http://flow-1/asset-48","type":"http://flow-1#Description","target":"Remote Admin$"},{"source":"http://flow-1/asset-85","type":"http://flow-1#Description","target":"Data"},{"source":"http://flow-1/asset-97","type":"http://flow-1#Description-","target":"System Process"}]}